import{logger}from"./logger.js";const DSN_REGEX=/^(?:(\w+):)\/\/(?:(\w+)(?::(\w+)?)?@)([\w.-]+)(?::(\d+))?\/(.+)/;function isValidProtocol(protocol){return"http"===protocol||"https"===protocol}function dsnToString(dsn,withPassword=!1){const{host:host,path:path,pass:pass,port:port,projectId:projectId,protocol:protocol,publicKey:publicKey}=dsn;return`${protocol}://${publicKey}${withPassword&&pass?`:${pass}`:""}@${host}${port?`:${port}`:""}/${path?`${path}/`:path}${projectId}`}function dsnFromString(str){const match=DSN_REGEX.exec(str);if(!match)return void console.error(`Invalid Sentry Dsn: ${str}`);const[protocol,publicKey,pass="",host,port="",lastPath]=match.slice(1);let path="",projectId=lastPath;const split=projectId.split("/");if(split.length>1&&(path=split.slice(0,-1).join("/"),projectId=split.pop()),projectId){const projectMatch=projectId.match(/^\d+/);projectMatch&&(projectId=projectMatch[0])}return dsnFromComponents({host:host,pass:pass,path:path,projectId:projectId,port:port,protocol:protocol,publicKey:publicKey})}function dsnFromComponents(components){return{protocol:components.protocol,publicKey:components.publicKey||"",pass:components.pass||"",host:components.host,port:components.port||"",path:components.path||"",projectId:components.projectId}}function validateDsn(dsn){if("undefined"!=typeof __SENTRY_DEBUG__&&!__SENTRY_DEBUG__)return!0;const{port:port,projectId:projectId,protocol:protocol}=dsn;return!["protocol","publicKey","host","projectId"].find((component=>!dsn[component]&&(logger.error(`Invalid Sentry Dsn: ${component} missing`),!0)))&&(projectId.match(/^\d+$/)?isValidProtocol(protocol)?!port||!isNaN(parseInt(port,10))||(logger.error(`Invalid Sentry Dsn: Invalid port ${port}`),!1):(logger.error(`Invalid Sentry Dsn: Invalid protocol ${protocol}`),!1):(logger.error(`Invalid Sentry Dsn: Invalid projectId ${projectId}`),!1))}function makeDsn(from){const components="string"==typeof from?dsnFromString(from):dsnFromComponents(from);if(components&&validateDsn(components))return components}export{dsnFromString,dsnToString,makeDsn};