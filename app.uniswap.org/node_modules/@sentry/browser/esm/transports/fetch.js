import{createTransport}from"@sentry/core";import{rejectedSyncPromise}from"@sentry/utils";import{getNativeFetchImplementation,clearCachedFetchImplementation}from"./utils.js";function makeFetchTransport(options,nativeFetch=getNativeFetchImplementation()){let pendingBodySize=0,pendingCount=0;return createTransport(options,(function(request){const requestSize=request.body.length;pendingBodySize+=requestSize,pendingCount++;const requestOptions={body:request.body,method:"POST",referrerPolicy:"origin",headers:options.headers,keepalive:pendingBodySize<=6e4&&pendingCount<15,...options.fetchOptions};try{return nativeFetch(options.url,requestOptions).then((response=>(pendingBodySize-=requestSize,pendingCount--,{statusCode:response.status,headers:{"x-sentry-rate-limits":response.headers.get("X-Sentry-Rate-Limits"),"retry-after":response.headers.get("Retry-After")}})))}catch(e){return clearCachedFetchImplementation(),pendingBodySize-=requestSize,pendingCount--,rejectedSyncPromise(e)}}))}export{makeFetchTransport};