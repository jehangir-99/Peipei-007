import{htmlTreeAsString}from"./browser.js";import{isError,isEvent,isInstanceOf,isElement,isPlainObject,isPrimitive}from"./is.js";import{logger}from"./logger.js";import{truncate}from"./string.js";function fill(source,name,replacementFactory){if(!(name in source))return;const original=source[name],wrapped=replacementFactory(original);"function"==typeof wrapped&&markFunctionWrapped(wrapped,original),source[name]=wrapped}function addNonEnumerableProperty(obj,name,value){try{Object.defineProperty(obj,name,{value:value,writable:!0,configurable:!0})}catch(o_O){("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&logger.log(`Failed to add non-enumerable property "${name}" to object`,obj)}}function markFunctionWrapped(wrapped,original){try{const proto=original.prototype||{};wrapped.prototype=original.prototype=proto,addNonEnumerableProperty(wrapped,"__sentry_original__",original)}catch(o_O){}}function getOriginalFunction(func){return func.__sentry_original__}function urlEncode(object){return Object.keys(object).map((key=>`${encodeURIComponent(key)}=${encodeURIComponent(object[key])}`)).join("&")}function convertToPlainObject(value){if(isError(value))return{message:value.message,name:value.name,stack:value.stack,...getOwnProperties(value)};if(isEvent(value)){const newObj={type:value.type,target:serializeEventTarget(value.target),currentTarget:serializeEventTarget(value.currentTarget),...getOwnProperties(value)};return"undefined"!=typeof CustomEvent&&isInstanceOf(value,CustomEvent)&&(newObj.detail=value.detail),newObj}return value}function serializeEventTarget(target){try{return isElement(target)?htmlTreeAsString(target):Object.prototype.toString.call(target)}catch(_oO){return"<unknown>"}}function getOwnProperties(obj){if("object"==typeof obj&&null!==obj){const extractedProps={};for(const property in obj)Object.prototype.hasOwnProperty.call(obj,property)&&(extractedProps[property]=obj[property]);return extractedProps}return{}}function extractExceptionKeysForMessage(exception,maxLength=40){const keys=Object.keys(convertToPlainObject(exception));if(keys.sort(),!keys.length)return"[object has no keys]";if(keys[0].length>=maxLength)return truncate(keys[0],maxLength);for(let includedKeys=keys.length;includedKeys>0;includedKeys--){const serialized=keys.slice(0,includedKeys).join(", ");if(!(serialized.length>maxLength))return includedKeys===keys.length?serialized:truncate(serialized,maxLength)}return""}function dropUndefinedKeys(inputValue){return _dropUndefinedKeys(inputValue,new Map)}function _dropUndefinedKeys(inputValue,memoizationMap){if(isPlainObject(inputValue)){const memoVal=memoizationMap.get(inputValue);if(void 0!==memoVal)return memoVal;const returnValue={};memoizationMap.set(inputValue,returnValue);for(const key of Object.keys(inputValue))void 0!==inputValue[key]&&(returnValue[key]=_dropUndefinedKeys(inputValue[key],memoizationMap));return returnValue}if(Array.isArray(inputValue)){const memoVal=memoizationMap.get(inputValue);if(void 0!==memoVal)return memoVal;const returnValue=[];return memoizationMap.set(inputValue,returnValue),inputValue.forEach((item=>{returnValue.push(_dropUndefinedKeys(item,memoizationMap))})),returnValue}return inputValue}function objectify(wat){let objectified;switch(!0){case null==wat:objectified=new String(wat);break;case"symbol"==typeof wat||"bigint"==typeof wat:objectified=Object(wat);break;case isPrimitive(wat):objectified=new wat.constructor(wat);break;default:objectified=wat}return objectified}export{addNonEnumerableProperty,convertToPlainObject,dropUndefinedKeys,extractExceptionKeysForMessage,fill,getOriginalFunction,markFunctionWrapped,objectify,urlEncode};