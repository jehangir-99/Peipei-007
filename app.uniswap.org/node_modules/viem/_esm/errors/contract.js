import{parseAccount}from"../accounts/utils/parseAccount.js";import{panicReasons}from"../constants/solidity.js";import{decodeErrorResult}from"../utils/abi/decodeErrorResult.js";import{formatAbiItem}from"../utils/abi/formatAbiItem.js";import{formatAbiItemWithArgs}from"../utils/abi/formatAbiItemWithArgs.js";import{getAbiItem}from"../utils/abi/getAbiItem.js";import{formatEther}from"../utils/unit/formatEther.js";import{formatGwei}from"../utils/unit/formatGwei.js";import{AbiErrorSignatureNotFoundError}from"./abi.js";import{BaseError}from"./base.js";import{prettyStateOverride}from"./stateOverride.js";import{prettyPrint}from"./transaction.js";import{getContractAddress}from"./utils.js";export class CallExecutionError extends BaseError{constructor(cause,{account:account_,docsPath:docsPath,chain:chain,data:data,gas:gas,gasPrice:gasPrice,maxFeePerGas:maxFeePerGas,maxPriorityFeePerGas:maxPriorityFeePerGas,nonce:nonce,to:to,value:value,stateOverride:stateOverride}){const account=account_?parseAccount(account_):void 0;let prettyArgs=prettyPrint({from:account?.address,to:to,value:void 0!==value&&`${formatEther(value)} ${chain?.nativeCurrency?.symbol||"ETH"}`,data:data,gas:gas,gasPrice:void 0!==gasPrice&&`${formatGwei(gasPrice)} gwei`,maxFeePerGas:void 0!==maxFeePerGas&&`${formatGwei(maxFeePerGas)} gwei`,maxPriorityFeePerGas:void 0!==maxPriorityFeePerGas&&`${formatGwei(maxPriorityFeePerGas)} gwei`,nonce:nonce});stateOverride&&(prettyArgs+=`\n${prettyStateOverride(stateOverride)}`),super(cause.shortMessage,{cause:cause,docsPath:docsPath,metaMessages:[...cause.metaMessages?[...cause.metaMessages," "]:[],"Raw Call Arguments:",prettyArgs].filter(Boolean)}),Object.defineProperty(this,"cause",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"CallExecutionError"}),this.cause=cause}}export class ContractFunctionExecutionError extends BaseError{constructor(cause,{abi:abi,args:args,contractAddress:contractAddress,docsPath:docsPath,functionName:functionName,sender:sender}){const abiItem=getAbiItem({abi:abi,args:args,name:functionName}),formattedArgs=abiItem?formatAbiItemWithArgs({abiItem:abiItem,args:args,includeFunctionName:!1,includeName:!1}):void 0,functionWithParams=abiItem?formatAbiItem(abiItem,{includeName:!0}):void 0,prettyArgs=prettyPrint({address:contractAddress&&getContractAddress(contractAddress),function:functionWithParams,args:formattedArgs&&"()"!==formattedArgs&&`${[...Array(functionName?.length??0).keys()].map((()=>" ")).join("")}${formattedArgs}`,sender:sender});super(cause.shortMessage||`An unknown error occurred while executing the contract function "${functionName}".`,{cause:cause,docsPath:docsPath,metaMessages:[...cause.metaMessages?[...cause.metaMessages," "]:[],"Contract Call:",prettyArgs].filter(Boolean)}),Object.defineProperty(this,"abi",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"args",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cause",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"contractAddress",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"formattedArgs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"functionName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"sender",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"ContractFunctionExecutionError"}),this.abi=abi,this.args=args,this.cause=cause,this.contractAddress=contractAddress,this.functionName=functionName,this.sender=sender}}export class ContractFunctionRevertedError extends BaseError{constructor({abi:abi,data:data,functionName:functionName,message:message}){let cause,decodedData,metaMessages,reason,signature;if(data&&"0x"!==data)try{decodedData=decodeErrorResult({abi:abi,data:data});const{abiItem:abiItem,errorName:errorName,args:errorArgs}=decodedData;if("Error"===errorName)reason=errorArgs[0];else if("Panic"===errorName){const[firstArg]=errorArgs;reason=panicReasons[firstArg]}else{const errorWithParams=abiItem?formatAbiItem(abiItem,{includeName:!0}):void 0,formattedArgs=abiItem&&errorArgs?formatAbiItemWithArgs({abiItem:abiItem,args:errorArgs,includeFunctionName:!1,includeName:!1}):void 0;metaMessages=[errorWithParams?`Error: ${errorWithParams}`:"",formattedArgs&&"()"!==formattedArgs?`       ${[...Array(errorName?.length??0).keys()].map((()=>" ")).join("")}${formattedArgs}`:""]}}catch(err){cause=err}else message&&(reason=message);cause instanceof AbiErrorSignatureNotFoundError&&(signature=cause.signature,metaMessages=[`Unable to decode signature "${signature}" as it was not found on the provided ABI.`,"Make sure you are using the correct ABI and that the error exists on it.",`You can look up the decoded signature here: https://openchain.xyz/signatures?query=${signature}.`]),super(reason&&"execution reverted"!==reason||signature?[`The contract function "${functionName}" reverted with the following ${signature?"signature":"reason"}:`,reason||signature].join("\n"):`The contract function "${functionName}" reverted.`,{cause:cause,metaMessages:metaMessages}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"ContractFunctionRevertedError"}),Object.defineProperty(this,"data",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reason",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"signature",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.data=decodedData,this.reason=reason,this.signature=signature}}export class ContractFunctionZeroDataError extends BaseError{constructor({functionName:functionName}){super(`The contract function "${functionName}" returned no data ("0x").`,{metaMessages:["This could be due to any of the following:",`  - The contract does not have the function "${functionName}",`,"  - The parameters passed to the contract function may be invalid, or","  - The address is not a contract."]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"ContractFunctionZeroDataError"})}}export class RawContractError extends BaseError{constructor({data:data,message:message}){super(message||""),Object.defineProperty(this,"code",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"RawContractError"}),Object.defineProperty(this,"data",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.data=data}}