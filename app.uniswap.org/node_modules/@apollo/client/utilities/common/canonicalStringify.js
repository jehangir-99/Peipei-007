import{AutoCleanedStrongCache,cacheSizes}from"../../utilities/caching/index.js";import{registerGlobalCache}from"../caching/getMemoryInternals.js";export var canonicalStringify=Object.assign((function(value){return JSON.stringify(value,stableObjectReplacer)}),{reset:function(){sortingMap=new AutoCleanedStrongCache(cacheSizes.canonicalStringify||1e3)}});var sortingMap;function stableObjectReplacer(key,value){if(value&&"object"==typeof value){var proto=Object.getPrototypeOf(value);if(proto===Object.prototype||null===proto){var keys=Object.keys(value);if(keys.every(everyKeyInOrder))return value;var unsortedKey=JSON.stringify(keys),sortedKeys=sortingMap.get(unsortedKey);if(!sortedKeys){keys.sort();var sortedKey=JSON.stringify(keys);sortedKeys=sortingMap.get(sortedKey)||keys,sortingMap.set(unsortedKey,sortedKeys),sortingMap.set(sortedKey,sortedKeys)}var sortedObject_1=Object.create(proto);return sortedKeys.forEach((function(key){sortedObject_1[key]=value[key]})),sortedObject_1}}return value}function everyKeyInOrder(key,i,keys){return 0===i||keys[i-1]<=key}!1!==globalThis.__DEV__&&registerGlobalCache("canonicalStringify",(function(){return sortingMap.size})),canonicalStringify.reset();