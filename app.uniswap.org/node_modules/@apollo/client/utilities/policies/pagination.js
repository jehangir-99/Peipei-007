import{__assign,__rest as __rest_1,__spreadArray}from"tslib";import{__rest}from"tslib";import{mergeDeep}from"../common/mergeDeep.js";export function concatPagination(keyArgs){return void 0===keyArgs&&(keyArgs=!1),{keyArgs:keyArgs,merge:function(existing,incoming){return existing?__spreadArray(__spreadArray([],existing,!0),incoming,!0):incoming}}}export function offsetLimitPagination(keyArgs){return void 0===keyArgs&&(keyArgs=!1),{keyArgs:keyArgs,merge:function(existing,incoming,_a){var args=_a.args,merged=existing?existing.slice(0):[];if(incoming)if(args)for(var _b=args.offset,offset=void 0===_b?0:_b,i=0;i<incoming.length;++i)merged[offset+i]=incoming[i];else merged.push.apply(merged,incoming);return merged}}}export function relayStylePagination(keyArgs){return void 0===keyArgs&&(keyArgs=!1),{keyArgs:keyArgs,read:function(existing,_a){var canRead=_a.canRead,readField=_a.readField;if(!existing)return existing;var edges=[],firstEdgeCursor="",lastEdgeCursor="";existing.edges.forEach((function(edge){canRead(readField("node",edge))&&(edges.push(edge),edge.cursor&&(firstEdgeCursor=firstEdgeCursor||edge.cursor||"",lastEdgeCursor=edge.cursor||lastEdgeCursor))})),edges.length>1&&firstEdgeCursor===lastEdgeCursor&&(firstEdgeCursor="");var _b=existing.pageInfo||{},startCursor=_b.startCursor,endCursor=_b.endCursor;return __assign(__assign({},getExtras(existing)),{edges:edges,pageInfo:__assign(__assign({},existing.pageInfo),{startCursor:startCursor||firstEdgeCursor,endCursor:endCursor||lastEdgeCursor})})},merge:function(existing,incoming,_a){var args=_a.args,isReference=_a.isReference,readField=_a.readField;if(existing||(existing=makeEmptyData()),!incoming)return existing;var incomingEdges=incoming.edges?incoming.edges.map((function(edge){return isReference(edge=__assign({},edge))&&(edge.cursor=readField("cursor",edge)),edge})):[];if(incoming.pageInfo){var pageInfo_1=incoming.pageInfo,startCursor=pageInfo_1.startCursor,endCursor=pageInfo_1.endCursor,firstEdge=incomingEdges[0],lastEdge=incomingEdges[incomingEdges.length-1];firstEdge&&startCursor&&(firstEdge.cursor=startCursor),lastEdge&&endCursor&&(lastEdge.cursor=endCursor);var firstCursor=firstEdge&&firstEdge.cursor;firstCursor&&!startCursor&&(incoming=mergeDeep(incoming,{pageInfo:{startCursor:firstCursor}}));var lastCursor=lastEdge&&lastEdge.cursor;lastCursor&&!endCursor&&(incoming=mergeDeep(incoming,{pageInfo:{endCursor:lastCursor}}))}var prefix=existing.edges,suffix=[];if(args&&args.after)(index=prefix.findIndex((function(edge){return edge.cursor===args.after})))>=0&&(prefix=prefix.slice(0,index+1));else if(args&&args.before){var index;suffix=(index=prefix.findIndex((function(edge){return edge.cursor===args.before})))<0?prefix:prefix.slice(index),prefix=[]}else incoming.edges&&(prefix=[]);var edges=__spreadArray(__spreadArray(__spreadArray([],prefix,!0),incomingEdges,!0),suffix,!0),pageInfo=__assign(__assign({},incoming.pageInfo),existing.pageInfo);if(incoming.pageInfo){var _b=incoming.pageInfo,hasPreviousPage=_b.hasPreviousPage,hasNextPage=_b.hasNextPage,extras=(startCursor=_b.startCursor,endCursor=_b.endCursor,__rest_1(_b,["hasPreviousPage","hasNextPage","startCursor","endCursor"]));Object.assign(pageInfo,extras),prefix.length||(void 0!==hasPreviousPage&&(pageInfo.hasPreviousPage=hasPreviousPage),void 0!==startCursor&&(pageInfo.startCursor=startCursor)),suffix.length||(void 0!==hasNextPage&&(pageInfo.hasNextPage=hasNextPage),void 0!==endCursor&&(pageInfo.endCursor=endCursor))}return __assign(__assign(__assign({},getExtras(existing)),getExtras(incoming)),{edges:edges,pageInfo:pageInfo})}}}var getExtras=function(obj){return __rest(obj,notExtras)},notExtras=["edges","pageInfo"];function makeEmptyData(){return{edges:[],pageInfo:{hasPreviousPage:!1,hasNextPage:!0,startCursor:"",endCursor:""}}}