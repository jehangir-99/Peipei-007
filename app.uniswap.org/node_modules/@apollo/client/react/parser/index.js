import{invariant}from"../../utilities/globals/index.js";import{AutoCleanedWeakCache,cacheSizes}from"../../utilities/index.js";import{registerGlobalCache}from"../../utilities/caching/getMemoryInternals.js";export var DocumentType;var cache;!function(DocumentType){DocumentType[DocumentType.Query=0]="Query",DocumentType[DocumentType.Mutation=1]="Mutation",DocumentType[DocumentType.Subscription=2]="Subscription"}(DocumentType||(DocumentType={}));export function operationName(type){var name;switch(type){case DocumentType.Query:name="Query";break;case DocumentType.Mutation:name="Mutation";break;case DocumentType.Subscription:name="Subscription"}return name}export function parser(document){cache||(cache=new AutoCleanedWeakCache(cacheSizes.parser||1e3));var variables,type,cached=cache.get(document);if(cached)return cached;invariant(!!document&&!!document.kind,60,document);for(var fragments=[],queries=[],mutations=[],subscriptions=[],_i=0,_a=document.definitions;_i<_a.length;_i++){var x=_a[_i];if("FragmentDefinition"!==x.kind){if("OperationDefinition"===x.kind)switch(x.operation){case"query":queries.push(x);break;case"mutation":mutations.push(x);break;case"subscription":subscriptions.push(x)}}else fragments.push(x)}invariant(!fragments.length||queries.length||mutations.length||subscriptions.length,61),invariant(queries.length+mutations.length+subscriptions.length<=1,62,document,queries.length,subscriptions.length,mutations.length),type=queries.length?DocumentType.Query:DocumentType.Mutation,queries.length||mutations.length||(type=DocumentType.Subscription);var definitions=queries.length?queries:mutations.length?mutations:subscriptions;invariant(1===definitions.length,63,document,definitions.length);var definition=definitions[0];variables=definition.variableDefinitions||[];var payload={name:definition.name&&"Name"===definition.name.kind?definition.name.value:"data",type:type,variables:variables};return cache.set(document,payload),payload}parser.resetCache=function(){cache=void 0},!1!==globalThis.__DEV__&&registerGlobalCache("parser",(function(){return cache?cache.size:0}));export function verifyDocumentType(document,type){var operation=parser(document),requiredOperationName=operationName(type),usedOperationName=operationName(operation.type);invariant(operation.type===type,64,requiredOperationName,requiredOperationName,usedOperationName)}