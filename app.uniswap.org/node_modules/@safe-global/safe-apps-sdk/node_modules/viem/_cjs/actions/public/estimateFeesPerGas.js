"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.internal_estimateFeesPerGas=exports.estimateFeesPerGas=void 0;const fee_js_1=require("../../errors/fee.js"),getAction_js_1=require("../../utils/getAction.js"),estimateMaxPriorityFeePerGas_js_1=require("./estimateMaxPriorityFeePerGas.js"),getBlock_js_1=require("./getBlock.js"),getGasPrice_js_1=require("./getGasPrice.js");async function estimateFeesPerGas(client,args){return internal_estimateFeesPerGas(client,args)}async function internal_estimateFeesPerGas(client,args){const{block:block_,chain:chain=client.chain,request:request,type:type="eip1559"}=args||{},baseFeeMultiplier=await(async()=>"function"==typeof chain?.fees?.baseFeeMultiplier?chain.fees.baseFeeMultiplier({block:block_,client:client,request:request}):chain?.fees?.baseFeeMultiplier??1.2)();if(baseFeeMultiplier<1)throw new fee_js_1.BaseFeeScalarError;const denominator=10**(baseFeeMultiplier.toString().split(".")[1]?.length??0),multiply=base=>base*BigInt(Math.ceil(baseFeeMultiplier*denominator))/BigInt(denominator),block=block_||await(0,getAction_js_1.getAction)(client,getBlock_js_1.getBlock,"getBlock")({});if("function"==typeof chain?.fees?.estimateFeesPerGas)return chain.fees.estimateFeesPerGas({block:block_,client:client,multiply:multiply,request:request,type:type});if("eip1559"===type){if("bigint"!=typeof block.baseFeePerGas)throw new fee_js_1.Eip1559FeesNotSupportedError;const maxPriorityFeePerGas=request?.maxPriorityFeePerGas?request.maxPriorityFeePerGas:await(0,estimateMaxPriorityFeePerGas_js_1.internal_estimateMaxPriorityFeePerGas)(client,{block:block,chain:chain,request:request}),baseFeePerGas=multiply(block.baseFeePerGas);return{maxFeePerGas:request?.maxFeePerGas??baseFeePerGas+maxPriorityFeePerGas,maxPriorityFeePerGas:maxPriorityFeePerGas}}return{gasPrice:request?.gasPrice??multiply(await(0,getAction_js_1.getAction)(client,getGasPrice_js_1.getGasPrice,"getGasPrice")({}))}}exports.estimateFeesPerGas=estimateFeesPerGas,exports.internal_estimateFeesPerGas=internal_estimateFeesPerGas;