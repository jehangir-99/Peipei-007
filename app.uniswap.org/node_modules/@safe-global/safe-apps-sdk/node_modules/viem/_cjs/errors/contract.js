"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.RawContractError=exports.ContractFunctionZeroDataError=exports.ContractFunctionRevertedError=exports.ContractFunctionExecutionError=exports.CallExecutionError=void 0;const parseAccount_js_1=require("../accounts/utils/parseAccount.js"),solidity_js_1=require("../constants/solidity.js"),decodeErrorResult_js_1=require("../utils/abi/decodeErrorResult.js"),formatAbiItem_js_1=require("../utils/abi/formatAbiItem.js"),formatAbiItemWithArgs_js_1=require("../utils/abi/formatAbiItemWithArgs.js"),getAbiItem_js_1=require("../utils/abi/getAbiItem.js"),formatEther_js_1=require("../utils/unit/formatEther.js"),formatGwei_js_1=require("../utils/unit/formatGwei.js"),abi_js_1=require("./abi.js"),base_js_1=require("./base.js"),transaction_js_1=require("./transaction.js"),utils_js_1=require("./utils.js");class CallExecutionError extends base_js_1.BaseError{constructor(cause,{account:account_,docsPath:docsPath,chain:chain,data:data,gas:gas,gasPrice:gasPrice,maxFeePerGas:maxFeePerGas,maxPriorityFeePerGas:maxPriorityFeePerGas,nonce:nonce,to:to,value:value}){const account=account_?(0,parseAccount_js_1.parseAccount)(account_):void 0,prettyArgs=(0,transaction_js_1.prettyPrint)({from:account?.address,to:to,value:void 0!==value&&`${(0,formatEther_js_1.formatEther)(value)} ${chain?.nativeCurrency?.symbol||"ETH"}`,data:data,gas:gas,gasPrice:void 0!==gasPrice&&`${(0,formatGwei_js_1.formatGwei)(gasPrice)} gwei`,maxFeePerGas:void 0!==maxFeePerGas&&`${(0,formatGwei_js_1.formatGwei)(maxFeePerGas)} gwei`,maxPriorityFeePerGas:void 0!==maxPriorityFeePerGas&&`${(0,formatGwei_js_1.formatGwei)(maxPriorityFeePerGas)} gwei`,nonce:nonce});super(cause.shortMessage,{cause:cause,docsPath:docsPath,metaMessages:[...cause.metaMessages?[...cause.metaMessages," "]:[],"Raw Call Arguments:",prettyArgs].filter(Boolean)}),Object.defineProperty(this,"cause",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"CallExecutionError"}),this.cause=cause}}exports.CallExecutionError=CallExecutionError;class ContractFunctionExecutionError extends base_js_1.BaseError{constructor(cause,{abi:abi,args:args,contractAddress:contractAddress,docsPath:docsPath,functionName:functionName,sender:sender}){const abiItem=(0,getAbiItem_js_1.getAbiItem)({abi:abi,args:args,name:functionName}),formattedArgs=abiItem?(0,formatAbiItemWithArgs_js_1.formatAbiItemWithArgs)({abiItem:abiItem,args:args,includeFunctionName:!1,includeName:!1}):void 0,functionWithParams=abiItem?(0,formatAbiItem_js_1.formatAbiItem)(abiItem,{includeName:!0}):void 0,prettyArgs=(0,transaction_js_1.prettyPrint)({address:contractAddress&&(0,utils_js_1.getContractAddress)(contractAddress),function:functionWithParams,args:formattedArgs&&"()"!==formattedArgs&&`${[...Array(functionName?.length??0).keys()].map((()=>" ")).join("")}${formattedArgs}`,sender:sender});super(cause.shortMessage||`An unknown error occurred while executing the contract function "${functionName}".`,{cause:cause,docsPath:docsPath,metaMessages:[...cause.metaMessages?[...cause.metaMessages," "]:[],"Contract Call:",prettyArgs].filter(Boolean)}),Object.defineProperty(this,"abi",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"args",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cause",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"contractAddress",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"formattedArgs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"functionName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"sender",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"ContractFunctionExecutionError"}),this.abi=abi,this.args=args,this.cause=cause,this.contractAddress=contractAddress,this.functionName=functionName,this.sender=sender}}exports.ContractFunctionExecutionError=ContractFunctionExecutionError;class ContractFunctionRevertedError extends base_js_1.BaseError{constructor({abi:abi,data:data,functionName:functionName,message:message}){let cause,decodedData,metaMessages,reason,signature;if(data&&"0x"!==data)try{decodedData=(0,decodeErrorResult_js_1.decodeErrorResult)({abi:abi,data:data});const{abiItem:abiItem,errorName:errorName,args:errorArgs}=decodedData;if("Error"===errorName)reason=errorArgs[0];else if("Panic"===errorName){const[firstArg]=errorArgs;reason=solidity_js_1.panicReasons[firstArg]}else{const errorWithParams=abiItem?(0,formatAbiItem_js_1.formatAbiItem)(abiItem,{includeName:!0}):void 0,formattedArgs=abiItem&&errorArgs?(0,formatAbiItemWithArgs_js_1.formatAbiItemWithArgs)({abiItem:abiItem,args:errorArgs,includeFunctionName:!1,includeName:!1}):void 0;metaMessages=[errorWithParams?`Error: ${errorWithParams}`:"",formattedArgs&&"()"!==formattedArgs?`       ${[...Array(errorName?.length??0).keys()].map((()=>" ")).join("")}${formattedArgs}`:""]}}catch(err){cause=err}else message&&(reason=message);cause instanceof abi_js_1.AbiErrorSignatureNotFoundError&&(signature=cause.signature,metaMessages=[`Unable to decode signature "${signature}" as it was not found on the provided ABI.`,"Make sure you are using the correct ABI and that the error exists on it.",`You can look up the decoded signature here: https://openchain.xyz/signatures?query=${signature}.`]),super(reason&&"execution reverted"!==reason||signature?[`The contract function "${functionName}" reverted with the following ${signature?"signature":"reason"}:`,reason||signature].join("\n"):`The contract function "${functionName}" reverted.`,{cause:cause,metaMessages:metaMessages}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"ContractFunctionRevertedError"}),Object.defineProperty(this,"data",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reason",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"signature",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.data=decodedData,this.reason=reason,this.signature=signature}}exports.ContractFunctionRevertedError=ContractFunctionRevertedError;class ContractFunctionZeroDataError extends base_js_1.BaseError{constructor({functionName:functionName}){super(`The contract function "${functionName}" returned no data ("0x").`,{metaMessages:["This could be due to any of the following:",`  - The contract does not have the function "${functionName}",`,"  - The parameters passed to the contract function may be invalid, or","  - The address is not a contract."]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"ContractFunctionZeroDataError"})}}exports.ContractFunctionZeroDataError=ContractFunctionZeroDataError;class RawContractError extends base_js_1.BaseError{constructor({data:data,message:message}){super(message||""),Object.defineProperty(this,"code",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"RawContractError"}),Object.defineProperty(this,"data",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.data=data}}exports.RawContractError=RawContractError;