import{__assign,__read,__rest}from"tslib";import{BASE_CAMPAIGN}from"@amplitude/analytics-client-common";import{AMPLITUDE_PREFIX,createIdentifyEvent,Identify}from"@amplitude/analytics-core";export var getStorageKey=function(apiKey,postKey,limit){return void 0===postKey&&(postKey=""),void 0===limit&&(limit=10),[AMPLITUDE_PREFIX,postKey,apiKey.substring(0,limit)].filter(Boolean).join("_")};var domainWithoutSubdomain=function(domain){var parts=domain.split(".");return parts.length<=2?domain:parts.slice(parts.length-2,parts.length).join(".")};export var isNewCampaign=function(current,previous,options){current.referrer;var _a,referring_domain=current.referring_domain,currentCampaign=__rest(current,["referrer","referring_domain"]),_b=previous||{},prevReferringDomain=(_b.referrer,_b.referring_domain),previousCampaign=__rest(_b,["referrer","referring_domain"]);if(current.referring_domain&&(null===(_a=options.excludeReferrers)||void 0===_a?void 0:_a.includes(current.referring_domain)))return!1;var hasNewCampaign=JSON.stringify(currentCampaign)!==JSON.stringify(previousCampaign),hasNewDomain=domainWithoutSubdomain(referring_domain||"")!==domainWithoutSubdomain(prevReferringDomain||"");return!previous||hasNewCampaign||hasNewDomain};export var createCampaignEvent=function(campaign,options){var campaignParameters=__assign(__assign({},BASE_CAMPAIGN),campaign),identifyEvent=Object.entries(campaignParameters).reduce((function(identify,_a){var _b,_c=__read(_a,2),key=_c[0],value=_c[1];return identify.setOnce("initial_".concat(key),null!==(_b=null!=value?value:options.initialEmptyValue)&&void 0!==_b?_b:"EMPTY"),value?identify.set(key,value):identify.unset(key)}),new Identify);return createIdentifyEvent(identifyEvent)};