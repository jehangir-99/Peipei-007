import{__awaiter,__generator,__read}from"tslib";import{getOldCookieName}from"@amplitude/analytics-client-common";import{createCookieStorage,getDefaultConfig}from"../config";export var parseLegacyCookies=function(apiKey,options){return __awaiter(void 0,void 0,void 0,(function(){var storage,oldCookieName,cookies,_a,deviceId,userId,optOut,sessionId,lastEventTime,lastEventId,_b;return __generator(this,(function(_c){switch(_c.label){case 0:return[4,createCookieStorage(options)];case 1:return storage=_c.sent(),oldCookieName=getOldCookieName(apiKey),[4,storage.getRaw(oldCookieName)];case 2:return(cookies=_c.sent())?(null!==(_b=options.cookieUpgrade)&&void 0!==_b?_b:getDefaultConfig().cookieUpgrade)?[4,storage.remove(oldCookieName)]:[3,4]:[2,{optOut:!1}];case 3:_c.sent(),_c.label=4;case 4:return _a=__read(cookies.split("."),6),deviceId=_a[0],userId=_a[1],optOut=_a[2],sessionId=_a[3],lastEventTime=_a[4],lastEventId=_a[5],[2,{deviceId:deviceId,userId:decode(userId),sessionId:parseTime(sessionId),lastEventId:parseTime(lastEventId),lastEventTime:parseTime(lastEventTime),optOut:Boolean(optOut)}]}}))}))};export var parseTime=function(num){var integer=parseInt(num,32);if(!isNaN(integer))return integer};export var decode=function(value){if(atob&&escape&&value)try{return decodeURIComponent(escape(atob(value)))}catch(_a){return}};