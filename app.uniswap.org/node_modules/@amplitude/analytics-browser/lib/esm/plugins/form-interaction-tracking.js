import{__awaiter,__generator}from"tslib";import{PluginType}from"@amplitude/analytics-types";import{DEFAULT_FORM_START_EVENT,DEFAULT_FORM_SUBMIT_EVENT,FORM_ID,FORM_NAME,FORM_DESTINATION}from"../constants";export var formInteractionTracking=function(){var observer,eventListeners=[],addEventListener=function(element,type,handler){element.addEventListener(type,handler),eventListeners.push({element:element,type:type,handler:handler})};return{name:"@amplitude/plugin-form-interaction-tracking-browser",type:PluginType.ENRICHMENT,setup:function(config,amplitude){return __awaiter(void 0,void 0,void 0,(function(){var addFormInteractionListener;return __generator(this,(function(_a){return amplitude?("undefined"==typeof document||(addFormInteractionListener=function(form){var hasFormChanged=!1;addEventListener(form,"change",(function(){var _a;hasFormChanged||amplitude.track(DEFAULT_FORM_START_EVENT,((_a={})[FORM_ID]=form.id,_a[FORM_NAME]=form.name,_a[FORM_DESTINATION]=form.action,_a)),hasFormChanged=!0})),addEventListener(form,"submit",(function(){var _a,_b;hasFormChanged||amplitude.track(DEFAULT_FORM_START_EVENT,((_a={})[FORM_ID]=form.id,_a[FORM_NAME]=form.name,_a[FORM_DESTINATION]=form.action,_a)),amplitude.track(DEFAULT_FORM_SUBMIT_EVENT,((_b={})[FORM_ID]=form.id,_b[FORM_NAME]=form.name,_b[FORM_DESTINATION]=form.action,_b)),hasFormChanged=!1}))},Array.from(document.getElementsByTagName("form")).forEach(addFormInteractionListener),"undefined"!=typeof MutationObserver&&(observer=new MutationObserver((function(mutations){mutations.forEach((function(mutation){mutation.addedNodes.forEach((function(node){"FORM"===node.nodeName&&addFormInteractionListener(node),"querySelectorAll"in node&&"function"==typeof node.querySelectorAll&&Array.from(node.querySelectorAll("form")).map(addFormInteractionListener)}))}))}))).observe(document.body,{subtree:!0,childList:!0})),[2]):(config.loggerProvider.warn("Form interaction tracking requires a later version of @amplitude/analytics-browser. Form interaction events are not tracked."),[2])}))}))},execute:function(event){return __awaiter(void 0,void 0,void 0,(function(){return __generator(this,(function(_a){return[2,event]}))}))},teardown:function(){return __awaiter(void 0,void 0,void 0,(function(){return __generator(this,(function(_a){return null==observer||observer.disconnect(),eventListeners.forEach((function(_a){var element=_a.element,type=_a.type,handler=_a.handler;null==element||element.removeEventListener(type,handler)})),eventListeners=[],[2]}))}))}}};