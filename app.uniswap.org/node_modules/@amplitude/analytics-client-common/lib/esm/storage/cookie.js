import{__assign,__awaiter,__generator}from"tslib";import{getGlobalScope}from"../global-scope";var CookieStorage=function(){function CookieStorage(options){this.options=__assign({},options)}return CookieStorage.prototype.isEnabled=function(){return __awaiter(this,void 0,void 0,(function(){var testStrorage,testKey;return __generator(this,(function(_b){switch(_b.label){case 0:if(!getGlobalScope())return[2,!1];CookieStorage.testValue=String(Date.now()),testStrorage=new CookieStorage(this.options),testKey="AMP_TEST",_b.label=1;case 1:return _b.trys.push([1,4,5,7]),[4,testStrorage.set(testKey,CookieStorage.testValue)];case 2:return _b.sent(),[4,testStrorage.get(testKey)];case 3:return[2,_b.sent()===CookieStorage.testValue];case 4:return _b.sent(),[2,!1];case 5:return[4,testStrorage.remove(testKey)];case 6:return _b.sent(),[7];case 7:return[2]}}))}))},CookieStorage.prototype.get=function(key){return __awaiter(this,void 0,void 0,(function(){var value;return __generator(this,(function(_a){switch(_a.label){case 0:return[4,this.getRaw(key)];case 1:if(!(value=_a.sent()))return[2,void 0];try{try{value=decodeURIComponent(atob(value))}catch(_b){}return[2,JSON.parse(value)]}catch(_c){return[2,void 0]}return[2]}}))}))},CookieStorage.prototype.getRaw=function(key){var _a;return __awaiter(this,void 0,void 0,(function(){var globalScope,cookie,match;return __generator(this,(function(_b){return globalScope=getGlobalScope(),cookie=null!==(_a=null==globalScope?void 0:globalScope.document.cookie.split("; "))&&void 0!==_a?_a:[],(match=cookie.find((function(c){return 0===c.indexOf(key+"=")})))?[2,match.substring(key.length+1)]:[2,void 0]}))}))},CookieStorage.prototype.set=function(key,value){var _a;return __awaiter(this,void 0,void 0,(function(){var expirationDays,expires,expireDate,date,str,globalScope;return __generator(this,(function(_b){try{expirationDays=null!==(_a=this.options.expirationDays)&&void 0!==_a?_a:0,expireDate=void 0,(expires=null!==value?expirationDays:-1)&&((date=new Date).setTime(date.getTime()+24*expires*60*60*1e3),expireDate=date),str="".concat(key,"=").concat(btoa(encodeURIComponent(JSON.stringify(value)))),expireDate&&(str+="; expires=".concat(expireDate.toUTCString())),str+="; path=/",this.options.domain&&(str+="; domain=".concat(this.options.domain)),this.options.secure&&(str+="; Secure"),this.options.sameSite&&(str+="; SameSite=".concat(this.options.sameSite)),(globalScope=getGlobalScope())&&(globalScope.document.cookie=str)}catch(_c){}return[2]}))}))},CookieStorage.prototype.remove=function(key){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(_a){switch(_a.label){case 0:return[4,this.set(key,null)];case 1:return _a.sent(),[2]}}))}))},CookieStorage.prototype.reset=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(_a){return[2]}))}))},CookieStorage}();export{CookieStorage};