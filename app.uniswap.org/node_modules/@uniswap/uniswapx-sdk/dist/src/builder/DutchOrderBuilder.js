"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.DutchOrderBuilder=void 0;const tslib_1=require("tslib"),ethers_1=require("ethers"),tiny_invariant_1=tslib_1.__importDefault(require("tiny-invariant")),constants_1=require("../constants"),errors_1=require("../errors"),order_1=require("../order"),OrderBuilder_1=require("./OrderBuilder");class DutchOrderBuilder extends OrderBuilder_1.OrderBuilder{static fromOrder(order){const builder=new DutchOrderBuilder(order.chainId,order.info.reactor).deadline(order.info.deadline).decayEndTime(order.info.decayEndTime).decayStartTime(order.info.decayStartTime).swapper(order.info.swapper).nonce(order.info.nonce).input(order.info.input).exclusiveFiller(order.info.exclusiveFiller,order.info.exclusivityOverrideBps).validation({additionalValidationContract:order.info.additionalValidationContract,additionalValidationData:order.info.additionalValidationData});for(const output of order.info.outputs)builder.output(output);return builder}constructor(chainId,reactorAddress,permit2Address){super(),this.chainId=chainId,this.permit2Address=permit2Address;const mappedReactorAddress=constants_1.REACTOR_ADDRESS_MAPPING[chainId]?constants_1.REACTOR_ADDRESS_MAPPING[chainId][constants_1.OrderType.Dutch]:void 0;if(reactorAddress)this.reactor(reactorAddress);else{if(!mappedReactorAddress)throw new errors_1.MissingConfiguration("reactor",chainId.toString());this.reactor(mappedReactorAddress)}this.info={outputs:[],exclusiveFiller:ethers_1.ethers.constants.AddressZero,exclusivityOverrideBps:ethers_1.BigNumber.from(0)}}decayStartTime(decayStartTime){return this.info.decayStartTime=decayStartTime,this}decayEndTime(decayEndTime){return void 0===this.orderInfo.deadline&&super.deadline(decayEndTime),this.info.decayEndTime=decayEndTime,this}input(input){return this.info.input=input,this}output(output){return this.info.outputs||(this.info.outputs=[]),(0,tiny_invariant_1.default)(output.startAmount.gte(output.endAmount),`startAmount must be greater than endAmount: ${output.startAmount.toString()}`),this.info.outputs.push(output),this}deadline(deadline){return super.deadline(deadline),void 0===this.info.decayEndTime&&this.decayEndTime(deadline),this}swapper(swapper){return super.swapper(swapper),this}nonce(nonce){return super.nonce(nonce),this}validation(info){return super.validation(info),this}nonFeeRecipient(newRecipient,feeRecipient){return(0,tiny_invariant_1.default)(newRecipient!==feeRecipient,`newRecipient must be different from feeRecipient: ${newRecipient}`),this.info.outputs?(this.info.outputs=this.info.outputs.map((output=>feeRecipient&&output.recipient.toLowerCase()===feeRecipient.toLowerCase()?output:Object.assign(Object.assign({},output),{recipient:newRecipient}))),this):this}exclusiveFiller(exclusiveFiller,exclusivityOverrideBps){return this.info.exclusiveFiller=exclusiveFiller,this.info.exclusivityOverrideBps=exclusivityOverrideBps,this}build(){return(0,tiny_invariant_1.default)(void 0!==this.info.decayStartTime,"decayStartTime not set"),(0,tiny_invariant_1.default)(void 0!==this.info.input,"input not set"),(0,tiny_invariant_1.default)(void 0!==this.info.decayEndTime,"decayEndTime not set"),(0,tiny_invariant_1.default)(void 0!==this.info.exclusiveFiller,"exclusiveFiller not set"),(0,tiny_invariant_1.default)(void 0!==this.info.exclusivityOverrideBps,"exclusivityOverrideBps not set"),(0,tiny_invariant_1.default)(void 0!==this.info.outputs&&0!==this.info.outputs.length,"outputs not set"),(0,tiny_invariant_1.default)(void 0!==this.info.decayEndTime||void 0!==this.getOrderInfo().deadline,"Must set either deadline or decayEndTime"),(0,tiny_invariant_1.default)(!this.orderInfo.deadline||this.info.decayStartTime<=this.orderInfo.deadline,`decayStartTime must be before or same as deadline: ${this.info.decayStartTime}`),(0,tiny_invariant_1.default)(!this.orderInfo.deadline||this.info.decayEndTime<=this.orderInfo.deadline,`decayEndTime must be before or same as deadline: ${this.info.decayEndTime}`),new order_1.DutchOrder(Object.assign(this.getOrderInfo(),{decayStartTime:this.info.decayStartTime,decayEndTime:this.info.decayEndTime,exclusiveFiller:this.info.exclusiveFiller,exclusivityOverrideBps:this.info.exclusivityOverrideBps,input:this.info.input,outputs:this.info.outputs}),this.chainId,this.permit2Address)}}exports.DutchOrderBuilder=DutchOrderBuilder;