"use strict";var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0});var color_1=require("../color"),vbox_1=__importDefault(require("./vbox")),pqueue_1=__importDefault(require("./pqueue")),fractByPopulations=.75;function _splitBoxes(pq,target){for(var lastSize=pq.size();pq.size()<target;){var vbox=pq.pop();if(!(vbox&&vbox.count()>0))break;var _a=vbox.split(),vbox1=_a[0],vbox2=_a[1];if(pq.push(vbox1),vbox2&&vbox2.count()>0&&pq.push(vbox2),pq.size()===lastSize)break;lastSize=pq.size()}}var MMCQ=function(pixels,opts){if(0===pixels.length||opts.colorCount<2||opts.colorCount>256)throw new Error("Wrong MMCQ parameters");var vbox=vbox_1.default.build(pixels),hist=vbox.hist,pq=(Object.keys(hist).length,new pqueue_1.default((function(a,b){return a.count()-b.count()})));pq.push(vbox),_splitBoxes(pq,fractByPopulations*opts.colorCount);var pq2=new pqueue_1.default((function(a,b){return a.count()*a.volume()-b.count()*b.volume()}));return pq2.contents=pq.contents,_splitBoxes(pq2,opts.colorCount-pq2.size()),generateSwatches(pq2)};function generateSwatches(pq){for(var swatches=[];pq.size();){var v=pq.pop(),color=v.avg();color[0],color[1],color[2];swatches.push(new color_1.Swatch(color,v.count()))}return swatches}exports.default=MMCQ;