"use strict";var __extends=this&&this.__extends||function(){var extendStatics=function(d,b){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])},extendStatics(d,b)};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}(),__createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){void 0===k2&&(k2=k),Object.defineProperty(o,k2,{enumerable:!0,get:function(){return m[k]}})}:function(o,m,k,k2){void 0===k2&&(k2=k),o[k2]=m[k]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(o,v){Object.defineProperty(o,"default",{enumerable:!0,value:v})}:function(o,v){o.default=v}),__importStar=this&&this.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(null!=mod)for(var k in mod)"default"!==k&&Object.hasOwnProperty.call(mod,k)&&__createBinding(result,mod,k);return __setModuleDefault(result,mod),result};Object.defineProperty(exports,"__esModule",{value:!0});var base_1=require("./base"),Url=__importStar(require("url"));function isRelativeUrl(url){var u=Url.parse(url);return null===u.protocol&&null===u.host&&null===u.port}function isSameOrigin(a,b){var ua=Url.parse(a),ub=Url.parse(b);return ua.protocol===ub.protocol&&ua.hostname===ub.hostname&&ua.port===ub.port}var BrowserImage=function(_super){function BrowserImage(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(BrowserImage,_super),BrowserImage.prototype._initCanvas=function(){var img=this.image,canvas=this._canvas=document.createElement("canvas"),context=this._context=canvas.getContext("2d");canvas.className="vibrant-canvas",canvas.style.display="none",this._width=canvas.width=img.width,this._height=canvas.height=img.height,context.drawImage(img,0,0),document.body.appendChild(canvas)},BrowserImage.prototype.load=function(image){var _this=this,img=null,src=null;if("string"==typeof image)img=document.createElement("img"),isRelativeUrl(image)||isSameOrigin(window.location.href,image)||(img.crossOrigin="anonymous"),src=img.src=image;else{if(!(image instanceof HTMLImageElement))return Promise.reject(new Error("Cannot load buffer as an image in browser"));img=image,src=image.src}return this.image=img,new Promise((function(resolve,reject){var onImageLoad=function(){_this._initCanvas(),resolve(_this)};img.complete?onImageLoad():(img.onload=onImageLoad,img.onerror=function(e){return reject(new Error("Fail to load image: "+src))})}))},BrowserImage.prototype.clear=function(){this._context.clearRect(0,0,this._width,this._height)},BrowserImage.prototype.update=function(imageData){this._context.putImageData(imageData,0,0)},BrowserImage.prototype.getWidth=function(){return this._width},BrowserImage.prototype.getHeight=function(){return this._height},BrowserImage.prototype.resize=function(targetWidth,targetHeight,ratio){var canvas=this._canvas,context=this._context,img=this.image;this._width=canvas.width=targetWidth,this._height=canvas.height=targetHeight,context.scale(ratio,ratio),context.drawImage(img,0,0)},BrowserImage.prototype.getPixelCount=function(){return this._width*this._height},BrowserImage.prototype.getImageData=function(){return this._context.getImageData(0,0,this._width,this._height)},BrowserImage.prototype.remove=function(){this._canvas&&this._canvas.parentNode&&this._canvas.parentNode.removeChild(this._canvas)},BrowserImage}(base_1.ImageBase);exports.default=BrowserImage;