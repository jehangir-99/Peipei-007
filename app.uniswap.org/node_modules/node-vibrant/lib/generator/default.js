"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var color_1=require("../color"),util_1=require("../util"),defaults=require("lodash/defaults"),DefaultOpts={targetDarkLuma:.26,maxDarkLuma:.45,minLightLuma:.55,targetLightLuma:.74,minNormalLuma:.3,targetNormalLuma:.5,maxNormalLuma:.7,targetMutesSaturation:.3,maxMutesSaturation:.4,targetVibrantSaturation:1,minVibrantSaturation:.35,weightSaturation:3,weightLuma:6.5,weightPopulation:.5};function _findMaxPopulation(swatches){var p=0;return swatches.forEach((function(s){p=Math.max(p,s.getPopulation())})),p}function _isAlreadySelected(palette,s){return palette.Vibrant===s||palette.DarkVibrant===s||palette.LightVibrant===s||palette.Muted===s||palette.DarkMuted===s||palette.LightMuted===s}function _createComparisonValue(saturation,targetSaturation,luma,targetLuma,population,maxPopulation,opts){function invertDiff(value,targetValue){return 1-Math.abs(value-targetValue)}return function(){for(var values=[],_i=0;_i<arguments.length;_i++)values[_i]=arguments[_i];for(var sum=0,weightSum=0,i=0;i<values.length;i+=2){var value=values[i],weight=values[i+1];sum+=value*weight,weightSum+=weight}return sum/weightSum}(invertDiff(saturation,targetSaturation),opts.weightSaturation,invertDiff(luma,targetLuma),opts.weightLuma,population/maxPopulation,opts.weightPopulation)}function _findColorVariation(palette,swatches,maxPopulation,targetLuma,minLuma,maxLuma,targetSaturation,minSaturation,maxSaturation,opts){var max=null,maxValue=0;return swatches.forEach((function(swatch){var _a=swatch.getHsl(),s=_a[1],l=_a[2];if(s>=minSaturation&&s<=maxSaturation&&l>=minLuma&&l<=maxLuma&&!_isAlreadySelected(palette,swatch)){var value=_createComparisonValue(s,targetSaturation,l,targetLuma,swatch.getPopulation(),maxPopulation,opts);(null===max||value>maxValue)&&(max=swatch,maxValue=value)}})),max}function _generateVariationColors(swatches,maxPopulation,opts){var palette={};return palette.Vibrant=_findColorVariation(palette,swatches,maxPopulation,opts.targetNormalLuma,opts.minNormalLuma,opts.maxNormalLuma,opts.targetVibrantSaturation,opts.minVibrantSaturation,1,opts),palette.LightVibrant=_findColorVariation(palette,swatches,maxPopulation,opts.targetLightLuma,opts.minLightLuma,1,opts.targetVibrantSaturation,opts.minVibrantSaturation,1,opts),palette.DarkVibrant=_findColorVariation(palette,swatches,maxPopulation,opts.targetDarkLuma,0,opts.maxDarkLuma,opts.targetVibrantSaturation,opts.minVibrantSaturation,1,opts),palette.Muted=_findColorVariation(palette,swatches,maxPopulation,opts.targetNormalLuma,opts.minNormalLuma,opts.maxNormalLuma,opts.targetMutesSaturation,0,opts.maxMutesSaturation,opts),palette.LightMuted=_findColorVariation(palette,swatches,maxPopulation,opts.targetLightLuma,opts.minLightLuma,1,opts.targetMutesSaturation,0,opts.maxMutesSaturation,opts),palette.DarkMuted=_findColorVariation(palette,swatches,maxPopulation,opts.targetDarkLuma,0,opts.maxDarkLuma,opts.targetMutesSaturation,0,opts.maxMutesSaturation,opts),palette}function _generateEmptySwatches(palette,maxPopulation,opts){if(null===palette.Vibrant&&null===palette.DarkVibrant&&null===palette.LightVibrant){if(null===palette.DarkVibrant&&null!==palette.DarkMuted){var _a=palette.DarkMuted.getHsl(),h=_a[0],s=_a[1],l=_a[2];l=opts.targetDarkLuma,palette.DarkVibrant=new color_1.Swatch(util_1.hslToRgb(h,s,l),0)}if(null===palette.LightVibrant&&null!==palette.LightMuted){var _b=palette.LightMuted.getHsl();h=_b[0],s=_b[1],l=_b[2];l=opts.targetDarkLuma,palette.DarkVibrant=new color_1.Swatch(util_1.hslToRgb(h,s,l),0)}}if(null===palette.Vibrant&&null!==palette.DarkVibrant){var _c=palette.DarkVibrant.getHsl();h=_c[0],s=_c[1],l=_c[2];l=opts.targetNormalLuma,palette.Vibrant=new color_1.Swatch(util_1.hslToRgb(h,s,l),0)}else if(null===palette.Vibrant&&null!==palette.LightVibrant){var _d=palette.LightVibrant.getHsl();h=_d[0],s=_d[1],l=_d[2];l=opts.targetNormalLuma,palette.Vibrant=new color_1.Swatch(util_1.hslToRgb(h,s,l),0)}if(null===palette.DarkVibrant&&null!==palette.Vibrant){var _e=palette.Vibrant.getHsl();h=_e[0],s=_e[1],l=_e[2];l=opts.targetDarkLuma,palette.DarkVibrant=new color_1.Swatch(util_1.hslToRgb(h,s,l),0)}if(null===palette.LightVibrant&&null!==palette.Vibrant){var _f=palette.Vibrant.getHsl();h=_f[0],s=_f[1],l=_f[2];l=opts.targetLightLuma,palette.LightVibrant=new color_1.Swatch(util_1.hslToRgb(h,s,l),0)}if(null===palette.Muted&&null!==palette.Vibrant){var _g=palette.Vibrant.getHsl();h=_g[0],s=_g[1],l=_g[2];l=opts.targetMutesSaturation,palette.Muted=new color_1.Swatch(util_1.hslToRgb(h,s,l),0)}if(null===palette.DarkMuted&&null!==palette.DarkVibrant){var _h=palette.DarkVibrant.getHsl();h=_h[0],s=_h[1],l=_h[2];l=opts.targetMutesSaturation,palette.DarkMuted=new color_1.Swatch(util_1.hslToRgb(h,s,l),0)}if(null===palette.LightMuted&&null!==palette.LightVibrant){var _j=palette.LightVibrant.getHsl();h=_j[0],s=_j[1],l=_j[2];l=opts.targetMutesSaturation,palette.LightMuted=new color_1.Swatch(util_1.hslToRgb(h,s,l),0)}}var DefaultGenerator=function(swatches,opts){opts=defaults({},opts,DefaultOpts);var maxPopulation=_findMaxPopulation(swatches),palette=_generateVariationColors(swatches,maxPopulation,opts);return _generateEmptySwatches(palette,maxPopulation,opts),palette};exports.default=DefaultGenerator;