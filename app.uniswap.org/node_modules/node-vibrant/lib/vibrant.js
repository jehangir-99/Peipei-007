"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){void 0===k2&&(k2=k),Object.defineProperty(o,k2,{enumerable:!0,get:function(){return m[k]}})}:function(o,m,k,k2){void 0===k2&&(k2=k),o[k2]=m[k]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(o,v){Object.defineProperty(o,"default",{enumerable:!0,value:v})}:function(o,v){o.default=v}),__importStar=this&&this.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(null!=mod)for(var k in mod)"default"!==k&&Object.hasOwnProperty.call(mod,k)&&__createBinding(result,mod,k);return __setModuleDefault(result,mod),result},__importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0});var color_1=require("./color"),builder_1=__importDefault(require("./builder")),Util=__importStar(require("./util")),Quantizer=__importStar(require("./quantizer")),Generator=__importStar(require("./generator")),Filters=__importStar(require("./filter")),defaults=require("lodash/defaults"),Vibrant=function(){function Vibrant(_src,opts){this._src=_src,this.opts=defaults({},opts,Vibrant.DefaultOpts),this.opts.combinedFilter=Filters.combineFilters(this.opts.filters)}return Vibrant.from=function(src){return new builder_1.default(src)},Vibrant.prototype._process=function(image,opts){var quantizer=opts.quantizer,generator=opts.generator;return image.scaleDown(opts),image.applyFilter(opts.combinedFilter).then((function(imageData){return quantizer(imageData.data,opts)})).then((function(colors){return color_1.Swatch.applyFilter(colors,opts.combinedFilter)})).then((function(colors){return Promise.resolve(generator(colors))}))},Vibrant.prototype.palette=function(){return this.swatches()},Vibrant.prototype.swatches=function(){return this._palette},Vibrant.prototype.getPalette=function(cb){var _this=this,image=new this.opts.ImageClass,result=image.load(this._src).then((function(image){return _this._process(image,_this.opts)})).then((function(palette){return _this._palette=palette,image.remove(),palette}),(function(err){throw image.remove(),err}));return cb&&result.then((function(palette){return cb(null,palette)}),(function(err){return cb(err)})),result},Vibrant.Builder=builder_1.default,Vibrant.Quantizer=Quantizer,Vibrant.Generator=Generator,Vibrant.Filter=Filters,Vibrant.Util=Util,Vibrant.Swatch=color_1.Swatch,Vibrant.DefaultOpts={colorCount:64,quality:5,generator:Generator.Default,ImageClass:null,quantizer:Quantizer.MMCQ,filters:[Filters.Default]},Vibrant}();exports.default=Vibrant;