function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(source,!0).forEach((function(key){_defineProperty(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(source).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function _objectWithoutProperties(source,excluded){if(null==source)return{};var key,i,target=_objectWithoutPropertiesLoose(source,excluded);if(Object.getOwnPropertySymbols){var sourceSymbolKeys=Object.getOwnPropertySymbols(source);for(i=0;i<sourceSymbolKeys.length;i++)key=sourceSymbolKeys[i],excluded.indexOf(key)>=0||Object.prototype.propertyIsEnumerable.call(source,key)&&(target[key]=source[key])}return target}function _objectWithoutPropertiesLoose(source,excluded){if(null==source)return{};var key,i,target={},sourceKeys=Object.keys(source);for(i=0;i<sourceKeys.length;i++)key=sourceKeys[i],excluded.indexOf(key)>=0||(target[key]=source[key]);return target}import{FLUSH,PAUSE,PERSIST,PURGE,REHYDRATE,DEFAULT_VERSION}from"./constants";import autoMergeLevel1 from"./stateReconciler/autoMergeLevel1";import createPersistoid from"./createPersistoid";import defaultGetStoredState from"./getStoredState";import purgeStoredState from"./purgeStoredState";var DEFAULT_TIMEOUT=5e3;export default function persistReducer(config,baseReducer){if("production"!==process.env.NODE_ENV){if(!config)throw new Error("config is required for persistReducer");if(!config.key)throw new Error("key is required in persistor config");if(!config.storage)throw new Error("redux-persist: config.storage is required. Try using one of the provided storage engines `import storage from 'redux-persist/lib/storage'`")}var version=void 0!==config.version?config.version:DEFAULT_VERSION,stateReconciler=(config.debug,void 0===config.stateReconciler?autoMergeLevel1:config.stateReconciler),getStoredState=config.getStoredState||defaultGetStoredState,timeout=void 0!==config.timeout?config.timeout:DEFAULT_TIMEOUT,_persistoid=null,_purge=!1,_paused=!0,conditionalUpdate=function(state){return state._persist.rehydrated&&_persistoid&&!_paused&&_persistoid.update(state),state};return function(state,action){var _ref=state||{},_persist=_ref._persist,restState=_objectWithoutProperties(_ref,["_persist"]);if(action.type===PERSIST){var _sealed=!1,_rehydrate=function(payload,err){"production"!==process.env.NODE_ENV&&_sealed&&console.error('redux-persist: rehydrate for "'.concat(config.key,'" called after timeout.'),payload,err),_sealed||(action.rehydrate(config.key,payload,err),_sealed=!0)};if(timeout&&setTimeout((function(){!_sealed&&_rehydrate(void 0,new Error('redux-persist: persist timed out for persist key "'.concat(config.key,'"')))}),timeout),_paused=!1,_persistoid||(_persistoid=createPersistoid(config)),_persist)return _objectSpread({},baseReducer(restState,action),{_persist:_persist});if("function"!=typeof action.rehydrate||"function"!=typeof action.register)throw new Error("redux-persist: either rehydrate or register is not a function on the PERSIST action. This can happen if the action is being replayed. This is an unexplored use case, please open an issue and we will figure out a resolution.");return action.register(config.key),getStoredState(config).then((function(restoredState){(config.migrate||function(s,v){return Promise.resolve(s)})(restoredState,version).then((function(migratedState){_rehydrate(migratedState)}),(function(migrateErr){"production"!==process.env.NODE_ENV&&migrateErr&&console.error("redux-persist: migration error",migrateErr),_rehydrate(void 0,migrateErr)}))}),(function(err){_rehydrate(void 0,err)})),_objectSpread({},baseReducer(restState,action),{_persist:{version:version,rehydrated:!1}})}if(action.type===PURGE)return _purge=!0,action.result(purgeStoredState(config)),_objectSpread({},baseReducer(restState,action),{_persist:_persist});if(action.type===FLUSH)return action.result(_persistoid&&_persistoid.flush()),_objectSpread({},baseReducer(restState,action),{_persist:_persist});if(action.type===PAUSE)_paused=!0;else if(action.type===REHYDRATE){if(_purge)return _objectSpread({},restState,{_persist:_objectSpread({},_persist,{rehydrated:!0})});if(action.key===config.key){var reducedState=baseReducer(restState,action),inboundState=action.payload,_newState=_objectSpread({},!1!==stateReconciler&&void 0!==inboundState?stateReconciler(inboundState,state,reducedState,config):reducedState,{_persist:_objectSpread({},_persist,{rehydrated:!0})});return conditionalUpdate(_newState)}}if(!_persist)return baseReducer(state,action);var newState=baseReducer(restState,action);return newState===restState?state:conditionalUpdate(_objectSpread({},newState,{_persist:_persist}))}}