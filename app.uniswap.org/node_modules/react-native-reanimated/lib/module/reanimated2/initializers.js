"use strict";import{reportFatalErrorOnJS}from"./errors";import{isChromeDebugger,isJest,shouldBeUseWeb}from"./PlatformChecker";import{runOnJS,setupMicrotasks,callMicrotasks,runOnUIImmediately}from"./threads";import{mockedRequestAnimationFrame}from"./mockedRequestAnimationFrame";const IS_JEST=isJest(),SHOULD_BE_USE_WEB=shouldBeUseWeb(),IS_CHROME_DEBUGGER=isChromeDebugger();export function callGuardDEV(fn){for(var _len=arguments.length,args=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++)args[_key-1]=arguments[_key];try{return fn(...args)}catch(e){if(!global.__ErrorUtils)throw e;global.__ErrorUtils.reportFatalError(e)}}export function setupCallGuard(){global.__callGuardDEV=callGuardDEV,global.__ErrorUtils={reportFatalError:error=>{runOnJS(reportFatalErrorOnJS)({message:error.message,stack:error.stack})}}}const capturableConsole={...console};export function setupConsole(){IS_CHROME_DEBUGGER||(global.console={assert:runOnJS(capturableConsole.assert),debug:runOnJS(capturableConsole.debug),log:runOnJS(capturableConsole.log),warn:runOnJS(capturableConsole.warn),error:runOnJS(capturableConsole.error),info:runOnJS(capturableConsole.info)})}function setupRequestAnimationFrame(){const nativeRequestAnimationFrame=global.requestAnimationFrame;let animationFrameCallbacks=[],lastNativeAnimationFrameTimestamp=-1;global.__flushAnimationFrame=frameTimestamp=>{const currentCallbacks=animationFrameCallbacks;animationFrameCallbacks=[],currentCallbacks.forEach((f=>f(frameTimestamp))),callMicrotasks()},global.requestAnimationFrame=callback=>(animationFrameCallbacks.push(callback),1===animationFrameCallbacks.length&&nativeRequestAnimationFrame((timestamp=>{lastNativeAnimationFrameTimestamp>=timestamp||(lastNativeAnimationFrameTimestamp=timestamp,global.__frameTimestamp=timestamp,global.__flushAnimationFrame(timestamp),global.__frameTimestamp=void 0)})),-1)}export function initializeUIRuntime(){IS_JEST&&(globalThis.requestAnimationFrame=mockedRequestAnimationFrame),runOnUIImmediately((()=>{setupCallGuard(),setupConsole(),SHOULD_BE_USE_WEB||(setupMicrotasks(),setupRequestAnimationFrame())}))()}