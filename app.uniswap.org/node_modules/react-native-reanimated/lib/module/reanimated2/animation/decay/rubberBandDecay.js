"use strict";import{SLOPE_FACTOR,VELOCITY_EPS}from"./utils";const DERIVATIVE_EPS=.1;export function rubberBandDecay(animation,now,config){const{lastTimestamp:lastTimestamp,startTimestamp:startTimestamp,current:current,velocity:velocity}=animation,deltaTime=Math.min(now-lastTimestamp,64),clampIndex=Math.abs(current-config.clamp[0])<Math.abs(current-config.clamp[1])?0:1;let derivative=0;(current<config.clamp[0]||current>config.clamp[1])&&(derivative=current-config.clamp[clampIndex]);const v=velocity*Math.exp(-(1-config.deceleration)*(now-startTimestamp)*SLOPE_FACTOR)-derivative*config.rubberBandFactor;if(Math.abs(derivative)>.1)animation.springActive=!0;else{if(animation.springActive)return animation.current=config.clamp[clampIndex],!0;if(Math.abs(v)<VELOCITY_EPS)return!0}return animation.current=current+v*config.velocityFactor*deltaTime/1e3,animation.velocity=v,animation.lastTimestamp=now,!1}