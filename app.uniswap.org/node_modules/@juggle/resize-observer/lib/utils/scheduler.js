import{process}from"./process";import{global}from"./global";import{queueResizeObserver}from"./queueResizeObserver";var watching=0,isWatching=function(){return!!watching},CATCH_PERIOD=250,observerConfig={attributes:!0,characterData:!0,childList:!0,subtree:!0},events=["resize","load","transitionend","animationend","animationstart","animationiteration","keyup","keydown","mouseup","mousedown","mouseover","mouseout","blur","focus"],time=function(timeout){return void 0===timeout&&(timeout=0),Date.now()+timeout},scheduled=!1,Scheduler=function(){function Scheduler(){var _this=this;this.stopped=!0,this.listener=function(){return _this.schedule()}}return Scheduler.prototype.run=function(timeout){var _this=this;if(void 0===timeout&&(timeout=CATCH_PERIOD),!scheduled){scheduled=!0;var until=time(timeout);queueResizeObserver((function(){var elementsHaveResized=!1;try{elementsHaveResized=process()}finally{if(scheduled=!1,timeout=until-time(),!isWatching())return;elementsHaveResized?_this.run(1e3):timeout>0?_this.run(timeout):_this.start()}}))}},Scheduler.prototype.schedule=function(){this.stop(),this.run()},Scheduler.prototype.observe=function(){var _this=this,cb=function(){return _this.observer&&_this.observer.observe(document.body,observerConfig)};document.body?cb():global.addEventListener("DOMContentLoaded",cb)},Scheduler.prototype.start=function(){var _this=this;this.stopped&&(this.stopped=!1,this.observer=new MutationObserver(this.listener),this.observe(),events.forEach((function(name){return global.addEventListener(name,_this.listener,!0)})))},Scheduler.prototype.stop=function(){var _this=this;this.stopped||(this.observer&&this.observer.disconnect(),events.forEach((function(name){return global.removeEventListener(name,_this.listener,!0)})),this.stopped=!0)},Scheduler}(),scheduler=new Scheduler,updateCount=function(n){!watching&&n>0&&scheduler.start(),!(watching+=n)&&scheduler.stop()};export{scheduler,updateCount};