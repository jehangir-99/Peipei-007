import*as React from"react";import{notifyManager}from"@tanstack/query-core";import{useQueryErrorResetBoundary}from"./QueryErrorResetBoundary.js";import{useQueryClient}from"./QueryClientProvider.js";import{useIsRestoring}from"./isRestoring.js";import{ensurePreventErrorBoundaryRetry,getHasError,useClearResetErrorBoundary}from"./errorBoundaryUtils.js";import{ensureStaleTime,fetchOptimistic,shouldSuspend}from"./suspense.js";function useBaseQuery(options,Observer,queryClient){if("production"!==process.env.NODE_ENV&&("object"!=typeof options||Array.isArray(options)))throw new Error('Bad argument type. Starting with v5, only the "Object" form is allowed when calling query related functions. Please use the error stack to find the culprit call. More info here: https://tanstack.com/query/latest/docs/react/guides/migrating-to-v5#supports-a-single-signature-one-object');const client=useQueryClient(queryClient),isRestoring=useIsRestoring(),errorResetBoundary=useQueryErrorResetBoundary(),defaultedOptions=client.defaultQueryOptions(options);defaultedOptions._optimisticResults=isRestoring?"isRestoring":"optimistic",ensureStaleTime(defaultedOptions),ensurePreventErrorBoundaryRetry(defaultedOptions,errorResetBoundary),useClearResetErrorBoundary(errorResetBoundary);const[observer]=React.useState((()=>new Observer(client,defaultedOptions))),result=observer.getOptimisticResult(defaultedOptions);if(React.useSyncExternalStore(React.useCallback((onStoreChange=>{const unsubscribe=isRestoring?()=>{}:observer.subscribe(notifyManager.batchCalls(onStoreChange));return observer.updateResult(),unsubscribe}),[observer,isRestoring]),(()=>observer.getCurrentResult()),(()=>observer.getCurrentResult())),React.useEffect((()=>{observer.setOptions(defaultedOptions,{listeners:!1})}),[defaultedOptions,observer]),shouldSuspend(defaultedOptions,result))throw fetchOptimistic(defaultedOptions,observer,errorResetBoundary);if(getHasError({result:result,errorResetBoundary:errorResetBoundary,throwOnError:defaultedOptions.throwOnError,query:client.getQueryCache().get(defaultedOptions.queryHash)}))throw result.error;return defaultedOptions.notifyOnChangeProps?result:observer.trackResult(result)}export{useBaseQuery};