import{catchUserErrors}from"../../tools/catchUserErrors";import{DOCS_ORIGIN,display}from"../../tools/display";import{ExperimentalFeature,addExperimentalFeatures}from"../../tools/experimentalFeatures";import{ONE_SECOND}from"../../tools/utils/timeUtils";import{isPercentage}from"../../tools/utils/numberUtils";import{ONE_KIBI_BYTE}from"../../tools/utils/byteUtils";import{objectHasValue}from"../../tools/utils/objectUtils";import{assign}from"../../tools/utils/polyfills";import{selectSessionStoreStrategyType}from"../session/sessionStore";import{TrackingConsent}from"../trackingConsent";import{computeTransportConfiguration}from"./transportConfiguration";export var DefaultPrivacyLevel={ALLOW:"allow",MASK:"mask",MASK_USER_INPUT:"mask-user-input"};export var TraceContextInjection={ALL:"all",SAMPLED:"sampled"};function checkIfString(tag,tagName){return null==tag||"string"==typeof tag||(display.error("".concat(tagName," must be defined as a string")),!1)}function isDatadogSite(site){return/(datadog|ddog|datad0g|dd0g)/.test(site)}export function validateAndBuildConfiguration(initConfiguration){var _a,_b,_c,_d,_e;if(initConfiguration&&initConfiguration.clientToken)if(void 0===initConfiguration.sessionSampleRate||isPercentage(initConfiguration.sessionSampleRate))if(void 0===initConfiguration.telemetrySampleRate||isPercentage(initConfiguration.telemetrySampleRate))if(void 0===initConfiguration.telemetryConfigurationSampleRate||isPercentage(initConfiguration.telemetryConfigurationSampleRate))if(void 0===initConfiguration.telemetryUsageSampleRate||isPercentage(initConfiguration.telemetryUsageSampleRate)){if(checkIfString(initConfiguration.version,"Version")&&checkIfString(initConfiguration.env,"Env")&&checkIfString(initConfiguration.service,"Service"))if(void 0===initConfiguration.trackingConsent||objectHasValue(TrackingConsent,initConfiguration.trackingConsent)){if(!initConfiguration.site||isDatadogSite(initConfiguration.site))return Array.isArray(initConfiguration.enableExperimentalFeatures)&&addExperimentalFeatures(initConfiguration.enableExperimentalFeatures.filter((function(flag){return objectHasValue(ExperimentalFeature,flag)}))),assign({beforeSend:initConfiguration.beforeSend&&catchUserErrors(initConfiguration.beforeSend,"beforeSend threw an error:"),sessionStoreStrategyType:selectSessionStoreStrategyType(initConfiguration),sessionSampleRate:null!==(_a=initConfiguration.sessionSampleRate)&&void 0!==_a?_a:100,telemetrySampleRate:null!==(_b=initConfiguration.telemetrySampleRate)&&void 0!==_b?_b:20,telemetryConfigurationSampleRate:null!==(_c=initConfiguration.telemetryConfigurationSampleRate)&&void 0!==_c?_c:5,telemetryUsageSampleRate:null!==(_d=initConfiguration.telemetryUsageSampleRate)&&void 0!==_d?_d:5,service:initConfiguration.service||void 0,silentMultipleInit:!!initConfiguration.silentMultipleInit,allowUntrustedEvents:!!initConfiguration.allowUntrustedEvents,trackingConsent:null!==(_e=initConfiguration.trackingConsent)&&void 0!==_e?_e:TrackingConsent.GRANTED,batchBytesLimit:16*ONE_KIBI_BYTE,eventRateLimiterThreshold:3e3,maxTelemetryEventsPerPage:15,flushTimeout:30*ONE_SECOND,batchMessagesLimit:50,messageBytesLimit:256*ONE_KIBI_BYTE},computeTransportConfiguration(initConfiguration));display.error("Site should be a valid Datadog site. Learn more here: ".concat(DOCS_ORIGIN,"/getting_started/site/."))}else display.error('Tracking Consent should be either "granted" or "not-granted"')}else display.error("Telemetry Usage Sample Rate should be a number between 0 and 100");else display.error("Telemetry Configuration Sample Rate should be a number between 0 and 100");else display.error("Telemetry Sample Rate should be a number between 0 and 100");else display.error("Session Sample Rate should be a number between 0 and 100");else display.error("Client Token is not configured, we will not send any data.")}export function serializeConfiguration(initConfiguration){return{session_sample_rate:initConfiguration.sessionSampleRate,telemetry_sample_rate:initConfiguration.telemetrySampleRate,telemetry_configuration_sample_rate:initConfiguration.telemetryConfigurationSampleRate,telemetry_usage_sample_rate:initConfiguration.telemetryUsageSampleRate,use_before_send:!!initConfiguration.beforeSend,use_cross_site_session_cookie:initConfiguration.useCrossSiteSessionCookie,use_partitioned_cross_site_session_cookie:initConfiguration.usePartitionedCrossSiteSessionCookie,use_secure_session_cookie:initConfiguration.useSecureSessionCookie,use_proxy:!!initConfiguration.proxy,silent_multiple_init:initConfiguration.silentMultipleInit,track_session_across_subdomains:initConfiguration.trackSessionAcrossSubdomains,allow_fallback_to_local_storage:!!initConfiguration.allowFallbackToLocalStorage,store_contexts_across_pages:!!initConfiguration.storeContextsAcrossPages,allow_untrusted_events:!!initConfiguration.allowUntrustedEvents,tracking_consent:initConfiguration.trackingConsent}}