import{setTimeout}from"../../tools/timer";import{clocksNow,ONE_MINUTE}from"../../tools/utils/timeUtils";import{ErrorSource}from"../error/error.types";export function createEventRateLimiter(eventType,limit,onLimitReached){var eventCount=0,allowNextEvent=!1;return{isLimitReached:function(){if(0===eventCount&&setTimeout((function(){eventCount=0}),ONE_MINUTE),(eventCount+=1)<=limit||allowNextEvent)return allowNextEvent=!1,!1;if(eventCount===limit+1){allowNextEvent=!0;try{onLimitReached({message:"Reached max number of ".concat(eventType,"s by minute: ").concat(limit),source:ErrorSource.AGENT,startClocks:clocksNow()})}finally{allowNextEvent=!1}}return!0}}}