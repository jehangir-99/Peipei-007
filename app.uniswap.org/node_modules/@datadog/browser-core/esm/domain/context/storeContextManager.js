import{addEventListener,DOM_EVENT}from"../../browser/addEventListener";import{combine}from"../../tools/mergeInto";var CONTEXT_STORE_KEY_PREFIX="_dd_c",storageListeners=[];export function storeContextManager(configuration,contextManager,productKey,customerDataType){var storageKey=buildStorageKey(productKey,customerDataType);function getFromStorage(){var rawContext=localStorage.getItem(storageKey);return null!==rawContext?JSON.parse(rawContext):{}}storageListeners.push(addEventListener(configuration,window,DOM_EVENT.STORAGE,(function(_a){var key=_a.key;storageKey===key&&contextManager.setContext(getFromStorage())}))),contextManager.changeObservable.subscribe((function(){localStorage.setItem(storageKey,JSON.stringify(contextManager.getContext()))})),contextManager.setContext(combine(getFromStorage(),contextManager.getContext()))}export function buildStorageKey(productKey,customerDataType){return"".concat(CONTEXT_STORE_KEY_PREFIX,"_").concat(productKey,"_").concat(customerDataType)}export function removeStorageListeners(){storageListeners.map((function(listener){return listener.stop()}))}