import{setInterval,clearInterval}from"./timer";import{removeItem}from"./utils/arrayUtils";import{addDuration,relativeNow,ONE_MINUTE}from"./utils/timeUtils";var END_OF_TIMES=1/0;export var CLEAR_OLD_VALUES_INTERVAL=ONE_MINUTE;var ValueHistory=function(){function ValueHistory(expireDelay,maxEntries){var _this=this;this.expireDelay=expireDelay,this.maxEntries=maxEntries,this.entries=[],this.clearOldValuesInterval=setInterval((function(){return _this.clearOldValues()}),CLEAR_OLD_VALUES_INTERVAL)}return ValueHistory.prototype.add=function(value,startTime){var _this=this,entry={value:value,startTime:startTime,endTime:END_OF_TIMES,remove:function(){removeItem(_this.entries,entry)},close:function(endTime){entry.endTime=endTime}};return this.maxEntries&&this.entries.length>=this.maxEntries&&this.entries.pop(),this.entries.unshift(entry),entry},ValueHistory.prototype.find=function(startTime,options){void 0===startTime&&(startTime=END_OF_TIMES),void 0===options&&(options={returnInactive:!1});for(var _i=0,_a=this.entries;_i<_a.length;_i++){var entry=_a[_i];if(entry.startTime<=startTime){if(options.returnInactive||startTime<=entry.endTime)return entry.value;break}}},ValueHistory.prototype.closeActive=function(endTime){var latestEntry=this.entries[0];latestEntry&&latestEntry.endTime===END_OF_TIMES&&latestEntry.close(endTime)},ValueHistory.prototype.findAll=function(startTime,duration){void 0===startTime&&(startTime=END_OF_TIMES),void 0===duration&&(duration=0);var endTime=addDuration(startTime,duration);return this.entries.filter((function(entry){return entry.startTime<=endTime&&startTime<=entry.endTime})).map((function(entry){return entry.value}))},ValueHistory.prototype.reset=function(){this.entries=[]},ValueHistory.prototype.stop=function(){clearInterval(this.clearOldValuesInterval)},ValueHistory.prototype.clearOldValues=function(){for(var oldTimeThreshold=relativeNow()-this.expireDelay;this.entries.length>0&&this.entries[this.entries.length-1].endTime<oldTimeThreshold;)this.entries.pop()},ValueHistory}();export{ValueHistory};