import{monitor}from"./monitor";import{noop}from"./utils/functionUtils";export function readBytesFromStream(stream,callback,options){var reader=stream.getReader(),chunks=[],readBytesCount=0;function onDone(){var bytes,limitExceeded;if(reader.cancel().catch(noop),options.collectStreamBody){var completeBuffer_1;if(1===chunks.length)completeBuffer_1=chunks[0];else{completeBuffer_1=new Uint8Array(readBytesCount);var offset_1=0;chunks.forEach((function(chunk){completeBuffer_1.set(chunk,offset_1),offset_1+=chunk.length}))}bytes=completeBuffer_1.slice(0,options.bytesLimit),limitExceeded=completeBuffer_1.length>options.bytesLimit}callback(void 0,bytes,limitExceeded)}!function readMore(){reader.read().then(monitor((function(result){result.done?onDone():(options.collectStreamBody&&chunks.push(result.value),(readBytesCount+=result.value.length)>options.bytesLimit?onDone():readMore())})),monitor((function(error){return callback(error)})))}()}