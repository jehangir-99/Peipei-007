"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Sha256=void 0;var tslib_1=require("tslib"),constants_1=require("./constants"),RawSha256_1=require("./RawSha256"),util_1=require("@aws-crypto/util"),Sha256=function(){function Sha256(secret){if(this.hash=new RawSha256_1.RawSha256,secret){this.outer=new RawSha256_1.RawSha256;var inner=bufferFromSecret(secret),outer=new Uint8Array(constants_1.BLOCK_SIZE);outer.set(inner);for(var i=0;i<constants_1.BLOCK_SIZE;i++)inner[i]^=54,outer[i]^=92;this.hash.update(inner),this.outer.update(outer);for(i=0;i<inner.byteLength;i++)inner[i]=0}}return Sha256.prototype.update=function(toHash){if(!(0,util_1.isEmptyData)(toHash)&&!this.error)try{this.hash.update((0,util_1.convertToBuffer)(toHash))}catch(e){this.error=e}},Sha256.prototype.digestSync=function(){if(this.error)throw this.error;return this.outer?(this.outer.finished||this.outer.update(this.hash.digest()),this.outer.digest()):this.hash.digest()},Sha256.prototype.digest=function(){return(0,tslib_1.__awaiter)(this,void 0,void 0,(function(){return(0,tslib_1.__generator)(this,(function(_a){return[2,this.digestSync()]}))}))},Sha256}();function bufferFromSecret(secret){var input=(0,util_1.convertToBuffer)(secret);if(input.byteLength>constants_1.BLOCK_SIZE){var bufferHash=new RawSha256_1.RawSha256;bufferHash.update(input),input=bufferHash.digest()}var buffer=new Uint8Array(constants_1.BLOCK_SIZE);return buffer.set(input),buffer}exports.Sha256=Sha256;