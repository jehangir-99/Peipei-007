"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){var value;result.done?resolve(result.value):(value=result.value,value instanceof P?value:new P((function(resolve){resolve(value)}))).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))},__generator=this&&this.__generator||function(thisArg,body){var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return function(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(!(t=_.trys,(t=t.length>0&&t[t.length-1])||6!==op[0]&&2!==op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}([n,v])}}},__importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0});var uuid_1=require("uuid"),Constants_1=require("./utils/Constants"),StatsigAsyncStorage_1=__importDefault(require("./utils/StatsigAsyncStorage")),StatsigLocalStorage_1=__importDefault(require("./utils/StatsigLocalStorage")),SDKVersion_1=require("./SDKVersion"),Identity=function(){function Identity(user,overrideStableID,reactNativeUUID){var _a;this.platform=null,this.nativeModules=null,this.sdkType="js-client",this.reactNativeUUID=reactNativeUUID,this.user=user,this.sdkVersion=SDKVersion_1.version,this.statsigMetadata={sdkType:this.sdkType,sdkVersion:this.sdkVersion};var stableID=overrideStableID;StatsigAsyncStorage_1.default.asyncStorage||(stableID=null!==(_a=null!=stableID?stableID:StatsigLocalStorage_1.default.getItem(Constants_1.STATSIG_STABLE_ID_KEY))&&void 0!==_a?_a:this.getUUID()),stableID&&(this.statsigMetadata.stableID=stableID)}return Identity.prototype.saveStableID=function(){null!=this.statsigMetadata.stableID&&StatsigLocalStorage_1.default.setItem(Constants_1.STATSIG_STABLE_ID_KEY,this.statsigMetadata.stableID)},Identity.prototype.initAsync=function(){return __awaiter(this,void 0,void 0,(function(){var stableID;return __generator(this,(function(_a){switch(_a.label){case 0:return(stableID=this.statsigMetadata.stableID)?[3,2]:[4,StatsigAsyncStorage_1.default.getItemAsync(Constants_1.STATSIG_STABLE_ID_KEY)];case 1:stableID=null!=(stableID=_a.sent())?stableID:this.getUUID(),_a.label=2;case 2:return StatsigAsyncStorage_1.default.setItemAsync(Constants_1.STATSIG_STABLE_ID_KEY,stableID).catch((function(){})),this.statsigMetadata.stableID=stableID,[2,this]}}))}))},Identity.prototype.getSDKType=function(){return this.sdkType},Identity.prototype.getSDKVersion=function(){return this.sdkVersion},Identity.prototype.getStatsigMetadata=function(){return this.statsigMetadata.sdkType=this.sdkType,this.statsigMetadata.sdkVersion=this.sdkVersion,this.statsigMetadata},Identity.prototype.getUser=function(){return this.user},Identity.prototype.updateUser=function(user){this.user=user},Identity.prototype.setSDKPackageInfo=function(SDKPackageInfo){this.sdkType=SDKPackageInfo.sdkType,this.sdkVersion=SDKPackageInfo.sdkVersion},Identity.prototype.setPlatform=function(platform){this.platform=platform,this.updateMetadataFromNativeModules()},Identity.prototype.setNativeModules=function(nativeModules){this.nativeModules=nativeModules,this.updateMetadataFromNativeModules()},Identity.prototype.updateMetadataFromNativeModules=function(){var _a,_b,_c,_d,_e,_f,_g;null!=this.platform&&null!=this.nativeModules&&("android"===(null===(_a=this.platform.OS)||void 0===_a?void 0:_a.toLocaleLowerCase())?this.statsigMetadata.locale=null===(_b=this.nativeModules.I18nManager)||void 0===_b?void 0:_b.localeIdentifier:"ios"===(null===(_c=this.platform.OS)||void 0===_c?void 0:_c.toLocaleLowerCase())&&(this.statsigMetadata.locale=(null===(_e=null===(_d=this.nativeModules.SettingsManager)||void 0===_d?void 0:_d.settings)||void 0===_e?void 0:_e.AppleLocale)||(null===(_g=null===(_f=this.nativeModules.SettingsManager)||void 0===_f?void 0:_f.settings)||void 0===_g?void 0:_g.AppleLanguages[0])))},Identity.prototype.getUUID=function(){var _a,_b;return null!==(_b=null===(_a=this.reactNativeUUID)||void 0===_a?void 0:_a.v4())&&void 0!==_b?_b:(0,uuid_1.v4)()},Identity.prototype.setRNDeviceInfo=function(deviceInfo){var _a,_b,_c,_d,_e;this.statsigMetadata.appVersion=null!==(_a=deviceInfo.getVersion())&&void 0!==_a?_a:"",this.statsigMetadata.systemVersion=null!==(_b=deviceInfo.getSystemVersion())&&void 0!==_b?_b:"",this.statsigMetadata.systemName=null!==(_c=deviceInfo.getSystemName())&&void 0!==_c?_c:"",this.statsigMetadata.deviceModelName=null!==(_d=deviceInfo.getModel())&&void 0!==_d?_d:"",this.statsigMetadata.deviceModel=null!==(_e=deviceInfo.getDeviceId())&&void 0!==_e?_e:""},Identity.prototype.setExpoConstants=function(expoConstants){var _a,_b;this.statsigMetadata.appVersion=null!==(_b=null!==(_a=expoConstants.nativeAppVersion)&&void 0!==_a?_a:expoConstants.nativeBuildVersion)&&void 0!==_b?_b:""},Identity.prototype.setExpoDevice=function(expoDevice){var _a,_b,_c,_d;this.statsigMetadata.systemVersion=null!==(_a=expoDevice.osVersion)&&void 0!==_a?_a:"",this.statsigMetadata.systemName=null!==(_b=expoDevice.osName)&&void 0!==_b?_b:"",this.statsigMetadata.deviceModelName=null!==(_c=expoDevice.modelName)&&void 0!==_c?_c:"",this.statsigMetadata.deviceModel=null!==(_d=expoDevice.modelId)&&void 0!==_d?_d:""},Identity}();exports.default=Identity;