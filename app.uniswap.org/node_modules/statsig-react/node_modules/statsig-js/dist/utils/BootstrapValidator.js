"use strict";var __assign=this&&this.__assign||function(){return __assign=Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++)for(var p in s=arguments[i])Object.prototype.hasOwnProperty.call(s,p)&&(t[p]=s[p]);return t},__assign.apply(this,arguments)};Object.defineProperty(exports,"__esModule",{value:!0});var StatsigUser_1=require("../StatsigUser"),EvaluationReason_1=require("./EvaluationReason"),BootstrapValidator=function(){function BootstrapValidator(){}return BootstrapValidator.getEvaluationReasonForBootstrap=function(user,values,stableID){var isValid=!0,stableIDMistmatch=!1;try{var evaluatedKeys=values.evaluated_keys;if(evaluatedKeys&&"object"==typeof evaluatedKeys){var evaluatedKeysRecord=this.copyObject(evaluatedKeys),userToCompare=null==user?null:this.copyObject(user);isValid=isValid&&BootstrapValidator.validate(evaluatedKeysRecord,userToCompare)&&BootstrapValidator.validate(userToCompare,evaluatedKeysRecord);var customIDs=evaluatedKeys.customIDs;stableID!=(null==customIDs?void 0:customIDs.stableID)&&(stableIDMistmatch=!0)}var userHash=values.user_hash;userHash&&"string"==typeof userHash&&null!=user&&(isValid=isValid&&userHash===(0,StatsigUser_1.getUserHashWithoutStableID)(user))}catch(error){}return isValid?stableIDMistmatch?EvaluationReason_1.EvaluationReason.BootstrapStableIDMismatch:EvaluationReason_1.EvaluationReason.Bootstrap:EvaluationReason_1.EvaluationReason.InvalidBootstrap},BootstrapValidator.validate=function(one,two){if(null==one)return null==two;if(null==two)return!1;for(var _i=0,_a=Object.entries(one);_i<_a.length;_i++){var _b=_a[_i],key=_b[0],value=_b[1];if("stableID"!==key){if(typeof value!=typeof two[key])return!1;if("string"!=typeof value)return"object"==typeof value&&this.validate(value,two[key]);if(value!==two[key])return!1}}return!0},BootstrapValidator.copyObject=function(obj){if(null==obj)return null;var copy={};if((null==obj?void 0:obj.userID)&&(copy.userID=null==obj?void 0:obj.userID),null==obj?void 0:obj.customIDs){var customIDs=__assign({},obj.customIDs);delete customIDs.stableID,0!==Object.keys(customIDs).length&&(copy.customIDs=customIDs)}return copy},BootstrapValidator}();exports.default=BootstrapValidator;