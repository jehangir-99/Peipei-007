"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){void 0===k2&&(k2=k),Object.defineProperty(o,k2,{enumerable:!0,get:function(){return m[k]}})}:function(o,m,k,k2){void 0===k2&&(k2=k),o[k2]=m[k]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(o,v){Object.defineProperty(o,"default",{enumerable:!0,value:v})}:function(o,v){o.default=v}),__importStar=this&&this.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(null!=mod)for(var k in mod)"default"!==k&&Object.prototype.hasOwnProperty.call(mod,k)&&__createBinding(result,mod,k);return __setModuleDefault(result,mod),result},__importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0});var react_1=__importStar(require("react")),StatsigContext_1=__importDefault(require("./StatsigContext")),statsig_js_1=__importDefault(require("statsig-js")),Statsig_1=__importDefault(require("./Statsig"));function StatsigSynchronousProvider(_a){var children=_a.children,sdkKey=_a.sdkKey,user=_a.user,options=_a.options,initializeValues=_a.initializeValues,setUser=_a.setUser,shutdownOnUnmount=_a.shutdownOnUnmount,_b=(0,react_1.useState)(0),userVersion=_b[0],setUserVersion=_b[1],_c=(0,react_1.useState)(!0),initialized=_c[0],setInitialized=_c[1],firstUpdate=(0,react_1.useRef)(!0),userMemo=(0,react_1.useMemo)((function(){return user}),[JSON.stringify(user)]);(0,react_1.useMemo)((function(){return Statsig_1.default.bootstrap(sdkKey,initializeValues,userMemo,options),initializeValues}),[JSON.stringify(initializeValues)]),(0,react_1.useEffect)((function(){if(firstUpdate.current)return firstUpdate.current=!1,void("undefined"!=typeof window&&(window.__STATSIG_SDK__=Statsig_1.default,window.__STATSIG_JS_SDK__=statsig_js_1.default,window.__STATSIG_RERENDER_OVERRIDE__=function(){setUserVersion(userVersion+1)}));setInitialized(!1),Statsig_1.default.updateUser(user).then((function(){setUserVersion(userVersion+1),setInitialized(!0)}))}),[userMemo]),(0,react_1.useEffect)((function(){return Statsig_1.default.setReactContextUpdater((function(){return setUserVersion((function(version){return version+1}))})),function(){shutdownOnUnmount&&Statsig_1.default.shutdown(),Statsig_1.default.setReactContextUpdater(null)}}),[]);var contextValue=(0,react_1.useMemo)((function(){return{initialized:initialized,statsigPromise:null,userVersion:userVersion,initStarted:Statsig_1.default.initializeCalled(),updateUser:null!=setUser?setUser:function(){}}}),[initialized,userVersion,Statsig_1.default.initializeCalled(),setUser]);return react_1.default.createElement(StatsigContext_1.default.Provider,{value:contextValue},children)}exports.default=StatsigSynchronousProvider;