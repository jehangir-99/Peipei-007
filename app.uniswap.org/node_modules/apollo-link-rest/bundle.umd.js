!function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?factory(exports,require("@apollo/client/core"),require("@apollo/client/utilities"),require("qs")):"function"==typeof define&&define.amd?define(["exports","@apollo/client/core","@apollo/client/utilities","qs"],factory):factory(global["apollo-link-rest"]={},global.apolloClient.core,global.apolloClient.utilities,global.qs)}(this,(function(exports,core,utilities,qs){"use strict";var __awaiter=function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){var value;result.done?resolve(result.value):(value=result.value,value instanceof P?value:new P((function(resolve){resolve(value)}))).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))},__generator=function(thisArg,body){var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return function(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(!(t=_.trys,(t=t.length>0&&t[t.length-1])||6!==op[0]&&2!==op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}([n,v])}}};function getDirectiveInfoFromField(field,variables){if(field.directives&&field.directives.length){var directiveObj_1={};return field.directives.forEach((function(directive){directiveObj_1[directive.name.value]=utilities.argumentsObjectFromField(directive,variables)})),directiveObj_1}return null}var hasOwn=Object.prototype.hasOwnProperty;function merge(dest,src){null!==src&&"object"==typeof src&&Object.keys(src).forEach((function(key){var srcVal=src[key];hasOwn.call(dest,key)?merge(dest[key],srcVal):dest[key]=srcVal}))}function executeSelectionSet(selectionSet,rootValue,execContext){return __awaiter(this,void 0,void 0,(function(){var fragmentMap,contextValue,variables,result,execute,_this=this;return __generator(this,(function(_a){switch(_a.label){case 0:return fragmentMap=execContext.fragmentMap,contextValue=execContext.contextValue,variables=execContext.variableValues,result={},execute=function(selection){return __awaiter(_this,void 0,void 0,(function(){var fieldResult,resultFieldKey,fragment,typeCondition,fragmentResult;return __generator(this,(function(_a){switch(_a.label){case 0:return utilities.shouldInclude(selection,variables)?utilities.isField(selection)?[4,executeField(selection,rootValue,execContext)]:[3,2]:[2];case 1:return fieldResult=_a.sent(),resultFieldKey=utilities.resultKeyNameFromField(selection),void 0!==fieldResult&&(void 0===result[resultFieldKey]?result[resultFieldKey]=fieldResult:merge(result[resultFieldKey],fieldResult)),[2];case 2:if(utilities.isInlineFragment(selection))fragment=selection;else if(!(fragment=fragmentMap[selection.name.value]))throw new Error("No fragment named "+selection.name.value);return typeCondition=fragment.typeCondition.name.value,execContext.fragmentMatcher(rootValue,typeCondition,contextValue)?[4,executeSelectionSet(fragment.selectionSet,rootValue,execContext)]:[3,4];case 3:fragmentResult=_a.sent(),merge(result,fragmentResult),_a.label=4;case 4:return[2]}}))}))},[4,Promise.all(selectionSet.selections.map(execute))];case 1:return _a.sent(),execContext.resultMapper?[2,execContext.resultMapper(result,rootValue)]:[2,result]}}))}))}function executeField(field,rootValue,execContext){return __awaiter(this,void 0,void 0,(function(){var variables,contextValue,resolver,fieldName,args,info,result;return __generator(this,(function(_a){switch(_a.label){case 0:return variables=execContext.variableValues,contextValue=execContext.contextValue,resolver=execContext.resolver,fieldName=field.name.value,args=utilities.argumentsObjectFromField(field,variables),info={isLeaf:!field.selectionSet,resultKey:utilities.resultKeyNameFromField(field),directives:getDirectiveInfoFromField(field,variables),field:field},[4,resolver(fieldName,rootValue,args,contextValue,info)];case 1:return result=_a.sent(),field.selectionSet?null==result?[2,result]:Array.isArray(result)?[2,executeSubSelectedArray(field,result,execContext)]:[2,executeSelectionSet(field.selectionSet,result,execContext)]:[2,result]}}))}))}function executeSubSelectedArray(field,result,execContext){return Promise.all(result.map((function(item){return null===item?null:Array.isArray(item)?executeSubSelectedArray(field,item,execContext):executeSelectionSet(field.selectionSet,item,execContext)})))}var extendStatics,__extends=(extendStatics=function(d,b){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])},extendStatics(d,b)},function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}),__assign=function(){return __assign=Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++)for(var p in s=arguments[i])Object.prototype.hasOwnProperty.call(s,p)&&(t[p]=s[p]);return t},__assign.apply(this,arguments)},__awaiter$1=function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){var value;result.done?resolve(result.value):(value=result.value,value instanceof P?value:new P((function(resolve){resolve(value)}))).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))},__generator$1=function(thisArg,body){var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return function(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(!(t=_.trys,(t=t.length>0&&t[t.length-1])||6!==op[0]&&2!==op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}([n,v])}}},__spreadArrays=function(){for(var s=0,i=0,il=arguments.length;i<il;i++)s+=arguments[i].length;var r=Array(s),k=0;for(i=0;i<il;i++)for(var a=arguments[i],j=0,jl=a.length;j<jl;j++,k++)r[k]=a[j];return r},addTypeNameToResult=function(result,__typename,typePatcher,typePatcherContext){if(Array.isArray(result)){var fixedTypename_1=(noSpace=__typename.replace(/\s/g,"")).replace(/\[(.*)\]/,(function(str,matchStr,offset,fullStr){return((null!=matchStr&&matchStr.length)>0?matchStr:null)||noSpace}));return result.map((function(e){return addTypeNameToResult(e,fixedTypename_1,typePatcher,typePatcherContext)}))}var noSpace;return null==result||"number"==typeof result||"boolean"==typeof result||"string"==typeof result?result:typePatcher(result,__typename,typePatcher,typePatcherContext)};function findRestDirectivesThenInsertNullsForOmittedFields(resultKey,current,mainDefinition,fragmentMap,currentSelectionSet){return null==currentSelectionSet||null==current||"number"==typeof current||"boolean"==typeof current||"string"==typeof current||currentSelectionSet.selections.forEach((function(node){if(utilities.isInlineFragment(node))findRestDirectivesThenInsertNullsForOmittedFields(resultKey,current,mainDefinition,fragmentMap,node.selectionSet);else if("FragmentSpread"===node.kind){var fragment=fragmentMap[node.name.value];findRestDirectivesThenInsertNullsForOmittedFields(resultKey,current,mainDefinition,fragmentMap,fragment.selectionSet)}else{if(!utilities.isField(node))return function(node){throw new Error("Unhandled Node Type in SelectionSetNode.selections")}();utilities.resultKeyNameFromField(node)===resultKey&&null!=((field=node).directives&&field.directives.length?field.directives.find((function(directive){return"rest"===directive.name.value})):null)?insertNullsForAnyOmittedFields(current,mainDefinition,fragmentMap,node.selectionSet):findRestDirectivesThenInsertNullsForOmittedFields(resultKey,current,mainDefinition,fragmentMap,node.selectionSet)}var field})),current}function insertNullsForAnyOmittedFields(current,mainDefinition,fragmentMap,currentSelectionSet){null!=current&&"number"!=typeof current&&"boolean"!=typeof current&&"string"!=typeof current&&(Array.isArray(current)?current.forEach((function(c){return insertNullsForAnyOmittedFields(c,mainDefinition,fragmentMap,currentSelectionSet)})):currentSelectionSet.selections.forEach((function(node){if(utilities.isInlineFragment(node))insertNullsForAnyOmittedFields(current,mainDefinition,fragmentMap,node.selectionSet);else if("FragmentSpread"===node.kind){var fragment=fragmentMap[node.name.value];insertNullsForAnyOmittedFields(current,mainDefinition,fragmentMap,fragment.selectionSet)}else{if(!utilities.isField(node))return function(node){throw new Error("Unhandled Node Type in SelectionSetNode.selections")}();var value=current[node.name.value];"__typename"===node.name.value||(void 0===value?current[node.name.value]=null:null!=value&&"object"==typeof value&&null!=node.selectionSet&&insertNullsForAnyOmittedFields(value,mainDefinition,fragmentMap,node.selectionSet))}})))}var PathBuilder=function(){function PathBuilder(){}return PathBuilder.replacerForPath=function(path){if(path in PathBuilder.cache)return PathBuilder.cache[path];var queryOrigStartIndex=path.indexOf("?"),pathBits=path.split(PathBuilder.argReplacement),chunkActions=[],hasBegunQuery=!1;pathBits.reduce((function(processedCount,bit){if(""===bit||"{}"===bit)return processedCount+bit.length;var nextIndex=processedCount+bit.length;if("{"===bit[0]&&"}"===bit[bit.length-1]){var _keyPath_1=bit.slice(1,bit.length-1).split(".");chunkActions.push((function(props,useQSEncoder){try{var value=PathBuilderLookupValue(props,_keyPath_1);return useQSEncoder&&"object"==typeof value&&null!=value?qs.stringify(value):String(value)}catch(e){var key=[path,_keyPath_1.join(".")].join("|");return key in PathBuilder.warnTable||(console.warn("Warning: RestLink caught an error while unpacking",key,"This tends to happen if you forgot to pass a parameter needed for creating an @rest(path, or if RestLink was configured to deeply unpack a path parameter that wasn't provided. This message will only log once per detected instance. Trouble-shooting hint: check @rest(path: and the variables provided to this query."),PathBuilder.warnTable[key]=!0),""}}))}else chunkActions.push(bit),!hasBegunQuery&&nextIndex>=queryOrigStartIndex&&(hasBegunQuery=!0,chunkActions.push(!0));return nextIndex}),0);return PathBuilder.cache[path]=function(props){var hasEnteredQuery=!1;return chunkActions.reduce((function(accumulator,action){return"string"==typeof action?accumulator+action:"boolean"==typeof action?(hasEnteredQuery=!0,accumulator):accumulator+action(props,hasEnteredQuery)}),"")}},PathBuilder.cache={},PathBuilder.warnTable={},PathBuilder.argReplacement=/({[._a-zA-Z0-9]*})/,PathBuilder}();function PathBuilderLookupValue(tmp,keyPath){if(0===keyPath.length)return tmp;var remainingKeyPath=__spreadArrays(keyPath);return PathBuilderLookupValue(tmp[remainingKeyPath.shift()],remainingKeyPath)}var noMangleKeys=["__typename"],globalScope="object"==typeof globalThis&&globalThis||global,convertObjectKeys=function(object,__converter,keypath){void 0===keypath&&(keypath=[]);var converter=null;return converter=2!=__converter.length?function(name,keypath){return __converter(name)}:__converter,Array.isArray(object)?object.map((function(o,index){return convertObjectKeys(o,converter,__spreadArrays(keypath,[String(index)]))})):null==object||"object"!=typeof object||object.constructor!==Object||globalScope.FileList&&object instanceof FileList||globalScope.File&&object instanceof File?object:Object.keys(object).reduce((function(acc,key){var value=object[key];if(-1!==noMangleKeys.indexOf(key))return acc[key]=value,acc;var nestedKeyPath=__spreadArrays(keypath,[key]);return acc[converter(key,nestedKeyPath)]=convertObjectKeys(value,converter,nestedKeyPath),acc}),{})},noOpNameNormalizer=function(name){return name},normalizeHeaders=function(headers){return headers instanceof Headers?headers:new Headers(headers||{})},concatHeadersMergePolicy=function(){for(var headerGroups=[],_i=0;_i<arguments.length;_i++)headerGroups[_i]=arguments[_i];return headerGroups.reduce((function(accumulator,current){return current?(current.forEach||(current=normalizeHeaders(current)),current.forEach((function(value,key){accumulator.append(key,value)})),accumulator):accumulator}),new Headers)},makeOverrideHeadersMergePolicy=function(headersToOverride){return function(linkHeaders,requestHeaders){return function(linkHeaders,headersToOverride,requestHeaders){var result=new Headers;return linkHeaders.forEach((function(value,key){-1===headersToOverride.indexOf(key)&&result.append(key,value)})),concatHeadersMergePolicy(result,requestHeaders||new Headers)}(linkHeaders,headersToOverride,requestHeaders)}},SUPPORTED_HTTP_VERBS=["GET","POST","PUT","PATCH","DELETE"],addTypeToNode=function(node,typename){return null==node||"object"!=typeof node?node:Array.isArray(node)?node.map((function(item){return addTypeToNode(item,typename)})):(node.__typename=typename,node)},resolver=function(fieldName,root,args,context,info){return __awaiter$1(void 0,void 0,void 0,(function(){var directives,isLeaf,resultKey,exportVariablesByNode,exportVariables,copyExportVariables,aliasedNode,preAliasingNode,isATypeCall,credentials,endpoints,headers,customFetch,operationType,typePatcher,mainDefinition,fragmentDefinitions,linkLevelNameNormalizer,linkLevelNameDenormalizer,serializers,responseTransformer,fragmentMap,_a,path,endpoint,pathBuilder,endpointOption,allParams,pathWithParams,_b,method,type,bodyBuilder,bodyKey,perRequestNameDenormalizer,perRequestNameNormalizer,bodySerializer,body,overrideHeaders,maybeBody_1,serializedBody,requestParams,requestUrl,response,result,parsed,transformer,err_1;return __generator$1(this,(function(_c){switch(_c.label){case 0:if(directives=info.directives,isLeaf=info.isLeaf,resultKey=info.resultKey,exportVariablesByNode=context.exportVariablesByNode,exportVariables=exportVariablesByNode.get(root)||{},copyExportVariables=function(result){return result instanceof Array?result.forEach(copyExportVariables):exportVariablesByNode.set(result,__assign({},exportVariables)),result},aliasedNode=(root||{})[resultKey],preAliasingNode=(root||{})[fieldName],root&&directives&&directives.export&&(exportVariables[directives.export.as]=preAliasingNode),isATypeCall=directives&&directives.type,!isLeaf&&isATypeCall){if(directives.rest)throw new Error("Invalid use of @type(name: ...) directive on a call that also has @rest(...)");return copyExportVariables(preAliasingNode),[2,addTypeToNode(preAliasingNode,directives.type.name)]}if(!directives||!directives.rest)return[2,copyExportVariables(aliasedNode||preAliasingNode)];if(credentials=context.credentials,endpoints=context.endpoints,headers=context.headers,customFetch=context.customFetch,operationType=context.operationType,typePatcher=context.typePatcher,mainDefinition=context.mainDefinition,fragmentDefinitions=context.fragmentDefinitions,linkLevelNameNormalizer=context.fieldNameNormalizer,linkLevelNameDenormalizer=context.fieldNameDenormalizer,serializers=context.serializers,responseTransformer=context.responseTransformer,fragmentMap=utilities.createFragmentMap(fragmentDefinitions),_a=directives.rest,path=_a.path,endpoint=_a.endpoint,pathBuilder=_a.pathBuilder,endpointOption=function(endpoints,endpoint){var result=endpoints[endpoint||DEFAULT_ENDPOINT_KEY]||endpoints[DEFAULT_ENDPOINT_KEY];return"string"==typeof result?{uri:result}:__assign({responseTransformer:null},result)}(endpoints,endpoint),null==path&&null==pathBuilder)throw new Error('One of ("path" | "pathBuilder") must be set in the @rest() directive. This request had neither, please add one');if(pathBuilder||(path.includes(":")?(console.warn("Deprecated: '@rest(path:' contains a ':' colon, this format will be removed in future versions"),pathBuilder=function(_a){var args=_a.args,exportVariables=_a.exportVariables,legacyArgs=__assign(__assign({},args),exportVariables),pathWithParams=Object.keys(legacyArgs).reduce((function(acc,e){return function(endpoint,name,value){return void 0===value||void 0===name?endpoint:endpoint.replace(":"+name,value)}(acc,e,legacyArgs[e])}),path);if(pathWithParams.includes(":"))throw new Error('Missing parameters to run query, specify it in the query params or use an export directive. (If you need to use ":" inside a variable string make sure to encode the variables properly using `encodeURIComponent`. Alternatively see documentation about using pathBuilder.)');return pathWithParams}):pathBuilder=PathBuilder.replacerForPath(path)),allParams={args:args,exportVariables:exportVariables,context:context,"@rest":directives.rest,replacer:pathBuilder},pathWithParams=pathBuilder(allParams),_b=directives.rest,method=_b.method,type=_b.type,bodyBuilder=_b.bodyBuilder,bodyKey=_b.bodyKey,perRequestNameDenormalizer=_b.fieldNameDenormalizer,perRequestNameNormalizer=_b.fieldNameNormalizer,bodySerializer=_b.bodySerializer,method||(method="GET"),bodyKey||(bodyKey="input"),body=void 0,overrideHeaders=void 0,-1===["GET","DELETE"].indexOf(method)){if(!bodyBuilder){if(!(maybeBody_1=allParams.exportVariables[bodyKey]||allParams.args&&allParams.args[bodyKey]))throw new Error("[GraphQL "+method+" "+operationType+" using a REST call without a body]. No `"+bodyKey+"` was detected. Pass bodyKey, or bodyBuilder to the @rest() directive to resolve this.");bodyBuilder=function(argsWithExport){return maybeBody_1}}if(body=convertObjectKeys(bodyBuilder(allParams),perRequestNameDenormalizer||linkLevelNameDenormalizer||noOpNameNormalizer),serializedBody=void 0,"string"==typeof bodySerializer){if(!serializers.hasOwnProperty(bodySerializer))throw new Error('"bodySerializer" must correspond to configured serializer. Please make sure to specify a serializer called '+bodySerializer+' in the "bodySerializers" property of the RestLink.');serializedBody=serializers[bodySerializer](body,headers)}else serializedBody=bodySerializer?bodySerializer(body,headers):serializers[DEFAULT_SERIALIZER_KEY](body,headers);body=serializedBody.body,overrideHeaders=new Headers(serializedBody.headers)}return function(method,operationType){switch(operationType){case"query":if(-1!==SUPPORTED_HTTP_VERBS.indexOf(method.toUpperCase()))return;throw new Error('A "query" operation can only support "GET" requests but got "'+method+'".');case"mutation":if(-1!==SUPPORTED_HTTP_VERBS.indexOf(method.toUpperCase()))return;throw new Error('"mutation" operations do not support that HTTP-verb');case"subscription":throw new Error('A "subscription" operation is not supported yet.');default:;}}(method,operationType||"query"),requestParams=__assign({method:method,headers:overrideHeaders||headers,body:body},credentials?{credentials:credentials}:{}),requestUrl=""+endpointOption.uri+pathWithParams,[4,(customFetch||fetch)(requestUrl,requestParams)];case 1:return response=_c.sent(),context.responses.push(response),response.ok?(result=204===response.status||"0"===response.headers.get("Content-Length")?{}:response,[3,9]):[3,2];case 2:return 404!==response.status?[3,3]:(result=null,[3,9]);case 3:parsed=void 0,_c.label=4;case 4:return _c.trys.push([4,6,,8]),[4,response.clone().json()];case 5:return parsed=_c.sent(),[3,8];case 6:return _c.sent(),[4,response.clone().text()];case 7:return parsed=_c.sent(),[3,8];case 8:!function(response,result,message){var error=new Error(message);throw error.response=response,error.statusCode=response.status,error.result=result,error}(response,parsed,"Response not successful: Received status code "+response.status),_c.label=9;case 9:if(!(transformer=endpointOption.responseTransformer||responseTransformer))return[3,14];_c.label=10;case 10:return _c.trys.push([10,12,,13]),[4,transformer(result,type)];case 11:return result=_c.sent(),[3,13];case 12:throw err_1=_c.sent(),console.warn("An error occurred in a responseTransformer:"),err_1;case 13:return[3,16];case 14:return result&&result.json?[4,result.json()]:[3,16];case 15:result=_c.sent(),_c.label=16;case 16:return result=convertObjectKeys(result,perRequestNameNormalizer||linkLevelNameNormalizer||noOpNameNormalizer),result=findRestDirectivesThenInsertNullsForOmittedFields(resultKey,result,mainDefinition,fragmentMap,mainDefinition.selectionSet),result=addTypeNameToResult(result,type,typePatcher,{resolverParams:{fieldName:fieldName,root:root,args:args,context:context,info:info}}),[2,copyExportVariables(result)]}}))}))},DEFAULT_ENDPOINT_KEY="",DEFAULT_SERIALIZER_KEY="",DEFAULT_JSON_SERIALIZER=function(data,headers){return headers.has("content-type")||headers.append("Content-Type","application/json"),{body:JSON.stringify(data),headers:headers}},CONNECTION_REMOVE_CONFIG={test:function(directive){return"rest"===directive.name.value},remove:!0},RestLink=function(_super){function RestLink(_a){var _b,uri=_a.uri,endpoints=_a.endpoints,headers=_a.headers,fieldNameNormalizer=_a.fieldNameNormalizer,fieldNameDenormalizer=_a.fieldNameDenormalizer,typePatcher=_a.typePatcher,customFetch=_a.customFetch,credentials=_a.credentials,bodySerializers=_a.bodySerializers,defaultSerializer=_a.defaultSerializer,responseTransformer=_a.responseTransformer,_this=_super.call(this)||this,fallback={};if(fallback[DEFAULT_ENDPOINT_KEY]=uri||"",_this.endpoints=Object.assign({},endpoints||fallback),null==uri&&null==endpoints)throw new Error("A RestLink must be initialized with either 1 uri, or a map of keyed-endpoints");if(null!=uri){var currentDefaultURI=(endpoints||{})[DEFAULT_ENDPOINT_KEY];if(null!=currentDefaultURI&&currentDefaultURI!=uri)throw new Error("RestLink was configured with a default uri that doesn't match what's passed in to the endpoints map.");_this.endpoints[DEFAULT_ENDPOINT_KEY]=uri}if(null==_this.endpoints[DEFAULT_ENDPOINT_KEY]&&console.warn("RestLink configured without a default URI. All @rest(…) directives must provide an endpoint key!"),null==typePatcher)_this.typePatcher=function(result,__typename,_2){return __assign({__typename:__typename},result)};else{if(Array.isArray(typePatcher)||"object"!=typeof typePatcher||!Object.keys(typePatcher).map((function(key){return typePatcher[key]})).reduce((function(current,patcher){return current&&"function"==typeof patcher}),!0))throw new Error("RestLink was configured with a typePatcher of invalid type!");var table_1=typePatcher;_this.typePatcher=function(data,outerType,patchDeeper,context){var __typename=data.__typename||outerType;if(Array.isArray(data))return data.map((function(d){return patchDeeper(d,__typename,patchDeeper,context)}));var subPatcher=table_1[__typename]||function(result){return result};return __assign({__typename:__typename},subPatcher(data,__typename,patchDeeper,context))}}return bodySerializers&&bodySerializers.hasOwnProperty(DEFAULT_SERIALIZER_KEY)&&console.warn("RestLink was configured to override the default serializer! This may result in unexpected behavior"),_this.responseTransformer=responseTransformer||null,_this.fieldNameNormalizer=fieldNameNormalizer||null,_this.fieldNameDenormalizer=fieldNameDenormalizer||null,_this.headers=normalizeHeaders(headers),_this.credentials=credentials||null,_this.customFetch=customFetch,_this.serializers=__assign(((_b={})[DEFAULT_SERIALIZER_KEY]=defaultSerializer||DEFAULT_JSON_SERIALIZER,_b),bodySerializers||{}),_this.processedDocuments=new Map,_this}return __extends(RestLink,_super),RestLink.prototype.removeRestSetsFromDocument=function(query){var cached=this.processedDocuments.get(query);if(cached)return cached;utilities.checkDocument(query);var docClone=utilities.removeDirectivesFromDocument([CONNECTION_REMOVE_CONFIG],query);return this.processedDocuments.set(query,docClone),docClone},RestLink.prototype.request=function(operation,forward){var query=operation.query,variables=operation.variables,getContext=operation.getContext,setContext=operation.setContext,context=getContext();if(!utilities.hasDirectives(["rest"],query))return forward(operation);var nonRest=this.removeRestSetsFromDocument(query),headersMergePolicy=context.headersMergePolicy;null==headersMergePolicy&&Array.isArray(context.headersToOverride)?headersMergePolicy=makeOverrideHeadersMergePolicy(context.headersToOverride):null==headersMergePolicy&&(headersMergePolicy=concatHeadersMergePolicy);var headers=headersMergePolicy(this.headers,context.headers);headers.has("Accept")||headers.append("Accept","application/json");var obs,credentials=context.credentials||this.credentials,queryWithTypename=utilities.addTypenameToDocument(query),mainDefinition=utilities.getMainDefinition(query),fragmentDefinitions=utilities.getFragmentDefinitions(query),operationType=(mainDefinition||{}).operation||"query",requestContext={headers:headers,endpoints:this.endpoints,exportVariablesByNode:new Map,credentials:credentials,customFetch:this.customFetch,operationType:operationType,fieldNameNormalizer:this.fieldNameNormalizer,fieldNameDenormalizer:this.fieldNameDenormalizer,mainDefinition:mainDefinition,fragmentDefinitions:fragmentDefinitions,typePatcher:this.typePatcher,serializers:this.serializers,responses:[],responseTransformer:this.responseTransformer},resolverOptions={};return nonRest&&forward?(operation.query=nonRest,obs=forward(operation)):obs=core.Observable.of({data:{}}),obs.flatMap((function(_a){var data=_a.data,errors=_a.errors;return new core.Observable((function(observer){(function(resolver,document,rootValue,contextValue,variableValues,execOptions){void 0===execOptions&&(execOptions={});var mainDefinition=utilities.getMainDefinition(document),fragments=utilities.getFragmentDefinitions(document),execContext={fragmentMap:utilities.createFragmentMap(fragments),contextValue:contextValue,variableValues:variableValues,resultMapper:execOptions.resultMapper,resolver:resolver,fragmentMatcher:execOptions.fragmentMatcher||function(){return!0}};return executeSelectionSet(mainDefinition.selectionSet,rootValue,execContext)})(resolver,queryWithTypename,data,requestContext,variables,resolverOptions).then((function(data){setContext({restResponses:(context.restResponses||[]).concat(requestContext.responses)}),observer.next({data:data,errors:errors}),observer.complete()})).catch((function(err){"AbortError"!==err.name&&(err.result&&err.result.errors&&observer.next(err.result),observer.error(err))}))}))}))},RestLink}(core.ApolloLink);exports.RestLink=RestLink,exports.PathBuilder=PathBuilder,Object.defineProperty(exports,"__esModule",{value:!0})}));