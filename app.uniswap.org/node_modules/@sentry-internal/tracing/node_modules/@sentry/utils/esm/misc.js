import{addNonEnumerableProperty}from"./object.js";import{snipLine}from"./string.js";import{GLOBAL_OBJ}from"./worldwide.js";function uuid4(){const gbl=GLOBAL_OBJ,crypto=gbl.crypto||gbl.msCrypto;let getRandomByte=()=>16*Math.random();try{if(crypto&&crypto.randomUUID)return crypto.randomUUID().replace(/-/g,"");crypto&&crypto.getRandomValues&&(getRandomByte=()=>crypto.getRandomValues(new Uint8Array(1))[0])}catch(_){}return([1e7]+1e3+4e3+8e3+1e11).replace(/[018]/g,(c=>(c^(15&getRandomByte())>>c/4).toString(16)))}function getFirstException(event){return event.exception&&event.exception.values?event.exception.values[0]:void 0}function getEventDescription(event){const{message:message,event_id:eventId}=event;if(message)return message;const firstException=getFirstException(event);return firstException?firstException.type&&firstException.value?`${firstException.type}: ${firstException.value}`:firstException.type||firstException.value||eventId||"<unknown>":eventId||"<unknown>"}function addExceptionTypeValue(event,value,type){const exception=event.exception=event.exception||{},values=exception.values=exception.values||[],firstException=values[0]=values[0]||{};firstException.value||(firstException.value=value||""),firstException.type||(firstException.type=type||"Error")}function addExceptionMechanism(event,newMechanism){const firstException=getFirstException(event);if(!firstException)return;const currentMechanism=firstException.mechanism;if(firstException.mechanism={type:"generic",handled:!0,...currentMechanism,...newMechanism},newMechanism&&"data"in newMechanism){const mergedData={...currentMechanism&&currentMechanism.data,...newMechanism.data};firstException.mechanism.data=mergedData}}const SEMVER_REGEXP=/^(0|[1-9]\d*)\.(0|[1-9]\d*)\.(0|[1-9]\d*)(?:-((?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\.(?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\+([0-9a-zA-Z-]+(?:\.[0-9a-zA-Z-]+)*))?$/;function parseSemver(input){const match=input.match(SEMVER_REGEXP)||[],major=parseInt(match[1],10),minor=parseInt(match[2],10),patch=parseInt(match[3],10);return{buildmetadata:match[5],major:isNaN(major)?void 0:major,minor:isNaN(minor)?void 0:minor,patch:isNaN(patch)?void 0:patch,prerelease:match[4]}}function addContextToFrame(lines,frame,linesOfContext=5){if(void 0===frame.lineno)return;const maxLines=lines.length,sourceLine=Math.max(Math.min(maxLines-1,frame.lineno-1),0);frame.pre_context=lines.slice(Math.max(0,sourceLine-linesOfContext),sourceLine).map((line=>snipLine(line,0))),frame.context_line=snipLine(lines[Math.min(maxLines-1,sourceLine)],frame.colno||0),frame.post_context=lines.slice(Math.min(sourceLine+1,maxLines),sourceLine+1+linesOfContext).map((line=>snipLine(line,0)))}function checkOrSetAlreadyCaught(exception){if(exception&&exception.__sentry_captured__)return!0;try{addNonEnumerableProperty(exception,"__sentry_captured__",!0)}catch(err){}return!1}function arrayify(maybeArray){return Array.isArray(maybeArray)?maybeArray:[maybeArray]}export{addContextToFrame,addExceptionMechanism,addExceptionTypeValue,arrayify,checkOrSetAlreadyCaught,getEventDescription,parseSemver,uuid4};