import{logger,browserPerformanceTimeOrigin,addInstrumentationHandler}from"@sentry/utils";import{WINDOW}from"./types.js";function instrumentRoutingWithDefaults(customStartTransaction,startTransactionOnPageLoad=!0,startTransactionOnLocationChange=!0){if(!WINDOW||!WINDOW.location)return void(("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&logger.warn("Could not initialize routing instrumentation due to invalid location"));let activeTransaction,startingUrl=WINDOW.location.href;startTransactionOnPageLoad&&(activeTransaction=customStartTransaction({name:WINDOW.location.pathname,startTimestamp:browserPerformanceTimeOrigin?browserPerformanceTimeOrigin/1e3:void 0,op:"pageload",origin:"auto.pageload.browser",metadata:{source:"url"}})),startTransactionOnLocationChange&&addInstrumentationHandler("history",(({to:to,from:from})=>{void 0===from&&startingUrl&&-1!==startingUrl.indexOf(to)?startingUrl=void 0:from!==to&&(startingUrl=void 0,activeTransaction&&(("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&logger.log(`[Tracing] Finishing current transaction with op: ${activeTransaction.op}`),activeTransaction.finish()),activeTransaction=customStartTransaction({name:WINDOW.location.pathname,op:"navigation",origin:"auto.navigation.browser",metadata:{source:"url"}}))}))}export{instrumentRoutingWithDefaults};