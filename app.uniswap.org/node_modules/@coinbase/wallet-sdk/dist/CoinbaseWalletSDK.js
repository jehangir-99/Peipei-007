"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.CoinbaseWalletSDK=void 0;const wallet_logo_1=require("./assets/wallet-logo"),constants_1=require("./core/constants"),util_1=require("./core/util"),ScopedLocalStorage_1=require("./lib/ScopedLocalStorage"),CoinbaseWalletProvider_1=require("./provider/CoinbaseWalletProvider"),MobileRelay_1=require("./relay/mobile/MobileRelay"),MobileRelayUI_1=require("./relay/mobile/MobileRelayUI"),RelayEventManager_1=require("./relay/RelayEventManager"),WalletLinkRelayUI_1=require("./relay/walletlink/ui/WalletLinkRelayUI"),WalletLinkRelay_1=require("./relay/walletlink/WalletLinkRelay"),version_1=require("./version");class CoinbaseWalletSDK{constructor(options){var _a,_b,_c;this._appName="",this._appLogoUrl=null,this._relay=null,this._relayEventManager=null;const linkAPIUrl=options.linkAPIUrl||constants_1.LINK_API_URL;void 0===options.overrideIsMetaMask?this._overrideIsMetaMask=!1:this._overrideIsMetaMask=options.overrideIsMetaMask,this._overrideIsCoinbaseWallet=null===(_a=options.overrideIsCoinbaseWallet)||void 0===_a||_a,this._overrideIsCoinbaseBrowser=null!==(_b=options.overrideIsCoinbaseBrowser)&&void 0!==_b&&_b,this._diagnosticLogger=options.diagnosticLogger,this._reloadOnDisconnect=null===(_c=options.reloadOnDisconnect)||void 0===_c||_c;const url=new URL(linkAPIUrl),origin=`${url.protocol}//${url.host}`;if(this._storage=new ScopedLocalStorage_1.ScopedLocalStorage(`-walletlink:${origin}`),this._storage.setItem("version",CoinbaseWalletSDK.VERSION),this.walletExtension||this.coinbaseBrowser)return;this._relayEventManager=new RelayEventManager_1.RelayEventManager;const isMobile=(0,util_1.isMobileWeb)(),uiConstructor=options.uiConstructor||(opts=>isMobile?new MobileRelayUI_1.MobileRelayUI(opts):new WalletLinkRelayUI_1.WalletLinkRelayUI(opts)),relayOption={linkAPIUrl:linkAPIUrl,version:version_1.LIB_VERSION,darkMode:!!options.darkMode,uiConstructor:uiConstructor,storage:this._storage,relayEventManager:this._relayEventManager,diagnosticLogger:this._diagnosticLogger,reloadOnDisconnect:this._reloadOnDisconnect,enableMobileWalletLink:options.enableMobileWalletLink};this._relay=isMobile?new MobileRelay_1.MobileRelay(relayOption):new WalletLinkRelay_1.WalletLinkRelay(relayOption),this.setAppInfo(options.appName,options.appLogoUrl),options.headlessMode||this._relay.attachUI()}makeWeb3Provider(jsonRpcUrl="",chainId=1){const extension=this.walletExtension;if(extension)return this.isCipherProvider(extension)||extension.setProviderInfo(jsonRpcUrl,chainId),!1===this._reloadOnDisconnect&&"function"==typeof extension.disableReloadOnDisconnect&&extension.disableReloadOnDisconnect(),extension;const dappBrowser=this.coinbaseBrowser;if(dappBrowser)return dappBrowser;const relay=this._relay;if(!relay||!this._relayEventManager||!this._storage)throw new Error("Relay not initialized, should never happen");return jsonRpcUrl||relay.setConnectDisabled(!0),new CoinbaseWalletProvider_1.CoinbaseWalletProvider({relayProvider:()=>Promise.resolve(relay),relayEventManager:this._relayEventManager,storage:this._storage,jsonRpcUrl:jsonRpcUrl,chainId:chainId,qrUrl:this.getQrUrl(),diagnosticLogger:this._diagnosticLogger,overrideIsMetaMask:this._overrideIsMetaMask,overrideIsCoinbaseWallet:this._overrideIsCoinbaseWallet,overrideIsCoinbaseBrowser:this._overrideIsCoinbaseBrowser})}setAppInfo(appName,appLogoUrl){var _a;this._appName=appName||"DApp",this._appLogoUrl=appLogoUrl||(0,util_1.getFavicon)();const extension=this.walletExtension;extension?this.isCipherProvider(extension)||extension.setAppInfo(this._appName,this._appLogoUrl):null===(_a=this._relay)||void 0===_a||_a.setAppInfo(this._appName,this._appLogoUrl)}disconnect(){var _a;const extension=null==this?void 0:this.walletExtension;extension?extension.close():null===(_a=this._relay)||void 0===_a||_a.resetAndReload()}getQrUrl(){var _a,_b;return null!==(_b=null===(_a=this._relay)||void 0===_a?void 0:_a.getQRCodeUrl())&&void 0!==_b?_b:null}getCoinbaseWalletLogo(type,width=240){return(0,wallet_logo_1.walletLogo)(type,width)}get walletExtension(){var _a;return null!==(_a=window.coinbaseWalletExtension)&&void 0!==_a?_a:window.walletLinkExtension}get coinbaseBrowser(){var _a,_b;try{const ethereum=null!==(_a=window.ethereum)&&void 0!==_a?_a:null===(_b=window.top)||void 0===_b?void 0:_b.ethereum;if(!ethereum)return;return"isCoinbaseBrowser"in ethereum&&ethereum.isCoinbaseBrowser?ethereum:void 0}catch(e){return}}isCipherProvider(provider){return"boolean"==typeof provider.isCipher&&provider.isCipher}}exports.CoinbaseWalletSDK=CoinbaseWalletSDK,CoinbaseWalletSDK.VERSION=version_1.LIB_VERSION;