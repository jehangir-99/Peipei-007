"use strict";var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.isMobileWeb=exports.getLocation=exports.isInIFrame=exports.createQrUrl=exports.getFavicon=exports.range=exports.isBigNumber=exports.ensureParsedJSONObject=exports.ensureBN=exports.ensureRegExpString=exports.ensureIntNumber=exports.ensureBuffer=exports.ensureAddressString=exports.ensureEvenLengthHexString=exports.ensureHexString=exports.isHexString=exports.prepend0x=exports.strip0x=exports.has0xPrefix=exports.hexStringFromIntNumber=exports.intNumberFromHexString=exports.bigIntStringFromBN=exports.hexStringFromBuffer=exports.hexStringToUint8Array=exports.uint8ArrayToHex=exports.randomBytesHex=void 0;const bn_js_1=__importDefault(require("bn.js")),error_1=require("./error"),type_1=require("./type"),INT_STRING_REGEX=/^[0-9]*$/,HEXADECIMAL_STRING_REGEX=/^[a-f0-9]*$/;function randomBytesHex(length){return uint8ArrayToHex(crypto.getRandomValues(new Uint8Array(length)))}function uint8ArrayToHex(value){return[...value].map((b=>b.toString(16).padStart(2,"0"))).join("")}function hexStringToUint8Array(hexString){return new Uint8Array(hexString.match(/.{1,2}/g).map((byte=>parseInt(byte,16))))}function hexStringFromBuffer(buf,includePrefix=!1){const hex=buf.toString("hex");return(0,type_1.HexString)(includePrefix?`0x${hex}`:hex)}function bigIntStringFromBN(bn){return(0,type_1.BigIntString)(bn.toString(10))}function intNumberFromHexString(hex){return(0,type_1.IntNumber)(new bn_js_1.default(ensureEvenLengthHexString(hex,!1),16).toNumber())}function hexStringFromIntNumber(num){return(0,type_1.HexString)(`0x${new bn_js_1.default(num).toString(16)}`)}function has0xPrefix(str){return str.startsWith("0x")||str.startsWith("0X")}function strip0x(hex){return has0xPrefix(hex)?hex.slice(2):hex}function prepend0x(hex){return has0xPrefix(hex)?`0x${hex.slice(2)}`:`0x${hex}`}function isHexString(hex){if("string"!=typeof hex)return!1;const s=strip0x(hex).toLowerCase();return HEXADECIMAL_STRING_REGEX.test(s)}function ensureHexString(hex,includePrefix=!1){if("string"==typeof hex){const s=strip0x(hex).toLowerCase();if(HEXADECIMAL_STRING_REGEX.test(s))return(0,type_1.HexString)(includePrefix?`0x${s}`:s)}throw error_1.standardErrors.rpc.invalidParams(`"${String(hex)}" is not a hexadecimal string`)}function ensureEvenLengthHexString(hex,includePrefix=!1){let h=ensureHexString(hex,!1);return h.length%2==1&&(h=(0,type_1.HexString)(`0${h}`)),includePrefix?(0,type_1.HexString)(`0x${h}`):h}function ensureAddressString(str){if("string"==typeof str){const s=strip0x(str).toLowerCase();if(isHexString(s)&&40===s.length)return(0,type_1.AddressString)(prepend0x(s))}throw error_1.standardErrors.rpc.invalidParams(`Invalid Ethereum address: ${String(str)}`)}function ensureBuffer(str){if(Buffer.isBuffer(str))return str;if("string"==typeof str){if(isHexString(str)){const s=ensureEvenLengthHexString(str,!1);return Buffer.from(s,"hex")}return Buffer.from(str,"utf8")}throw error_1.standardErrors.rpc.invalidParams(`Not binary data: ${String(str)}`)}function ensureIntNumber(num){if("number"==typeof num&&Number.isInteger(num))return(0,type_1.IntNumber)(num);if("string"==typeof num){if(INT_STRING_REGEX.test(num))return(0,type_1.IntNumber)(Number(num));if(isHexString(num))return(0,type_1.IntNumber)(new bn_js_1.default(ensureEvenLengthHexString(num,!1),16).toNumber())}throw error_1.standardErrors.rpc.invalidParams(`Not an integer: ${String(num)}`)}function ensureRegExpString(regExp){if(regExp instanceof RegExp)return(0,type_1.RegExpString)(regExp.toString());throw error_1.standardErrors.rpc.invalidParams(`Not a RegExp: ${String(regExp)}`)}function ensureBN(val){if(null!==val&&(bn_js_1.default.isBN(val)||isBigNumber(val)))return new bn_js_1.default(val.toString(10),10);if("number"==typeof val)return new bn_js_1.default(ensureIntNumber(val));if("string"==typeof val){if(INT_STRING_REGEX.test(val))return new bn_js_1.default(val,10);if(isHexString(val))return new bn_js_1.default(ensureEvenLengthHexString(val,!1),16)}throw error_1.standardErrors.rpc.invalidParams(`Not an integer: ${String(val)}`)}function ensureParsedJSONObject(val){if("string"==typeof val)return JSON.parse(val);if("object"==typeof val)return val;throw error_1.standardErrors.rpc.invalidParams(`Not a JSON string or an object: ${String(val)}`)}function isBigNumber(val){if(null==val||"function"!=typeof val.constructor)return!1;const{constructor:constructor}=val;return"function"==typeof constructor.config&&"number"==typeof constructor.EUCLID}function range(start,stop){return Array.from({length:stop-start},((_,i)=>start+i))}function getFavicon(){const el=document.querySelector('link[sizes="192x192"]')||document.querySelector('link[sizes="180x180"]')||document.querySelector('link[rel="icon"]')||document.querySelector('link[rel="shortcut icon"]'),{protocol:protocol,host:host}=document.location,href=el?el.getAttribute("href"):null;return!href||href.startsWith("javascript:")||href.startsWith("vbscript:")?null:href.startsWith("http://")||href.startsWith("https://")||href.startsWith("data:")?href:href.startsWith("//")?protocol+href:`${protocol}//${host}${href}`}function createQrUrl(sessionId,sessionSecret,serverUrl,isParentConnection,version,chainId){return`${serverUrl}/#/link?${new URLSearchParams({[isParentConnection?"parent-id":"id"]:sessionId,secret:sessionSecret,server:serverUrl,v:version,chainId:chainId.toString()}).toString()}`}function isInIFrame(){try{return null!==window.frameElement}catch(e){return!1}}function getLocation(){try{return isInIFrame()&&window.top?window.top.location:window.location}catch(e){return window.location}}function isMobileWeb(){var _a;return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(null===(_a=null===window||void 0===window?void 0:window.navigator)||void 0===_a?void 0:_a.userAgent)}exports.randomBytesHex=randomBytesHex,exports.uint8ArrayToHex=uint8ArrayToHex,exports.hexStringToUint8Array=hexStringToUint8Array,exports.hexStringFromBuffer=hexStringFromBuffer,exports.bigIntStringFromBN=bigIntStringFromBN,exports.intNumberFromHexString=intNumberFromHexString,exports.hexStringFromIntNumber=hexStringFromIntNumber,exports.has0xPrefix=has0xPrefix,exports.strip0x=strip0x,exports.prepend0x=prepend0x,exports.isHexString=isHexString,exports.ensureHexString=ensureHexString,exports.ensureEvenLengthHexString=ensureEvenLengthHexString,exports.ensureAddressString=ensureAddressString,exports.ensureBuffer=ensureBuffer,exports.ensureIntNumber=ensureIntNumber,exports.ensureRegExpString=ensureRegExpString,exports.ensureBN=ensureBN,exports.ensureParsedJSONObject=ensureParsedJSONObject,exports.isBigNumber=isBigNumber,exports.range=range,exports.getFavicon=getFavicon,exports.createQrUrl=createQrUrl,exports.isInIFrame=isInIFrame,exports.getLocation=getLocation,exports.isMobileWeb=isMobileWeb;