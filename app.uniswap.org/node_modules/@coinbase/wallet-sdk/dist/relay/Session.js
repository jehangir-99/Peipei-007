"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Session=void 0;const sha_js_1=require("sha.js"),util_1=require("../core/util"),STORAGE_KEY_SESSION_ID="session:id",STORAGE_KEY_SESSION_SECRET="session:secret",STORAGE_KEY_SESSION_LINKED="session:linked";class Session{constructor(storage,id,secret,linked){this._storage=storage,this._id=id||(0,util_1.randomBytesHex)(16),this._secret=secret||(0,util_1.randomBytesHex)(32),this._key=(new sha_js_1.sha256).update(`${this._id}, ${this._secret} WalletLink`).digest("hex"),this._linked=!!linked}static load(storage){const id=storage.getItem("session:id"),linked=storage.getItem("session:linked"),secret=storage.getItem("session:secret");return id&&secret?new Session(storage,id,secret,"1"===linked):null}static hash(sessionId){return(new sha_js_1.sha256).update(sessionId).digest("hex")}get id(){return this._id}get secret(){return this._secret}get key(){return this._key}get linked(){return this._linked}set linked(val){this._linked=val,this.persistLinked()}save(){return this._storage.setItem("session:id",this._id),this._storage.setItem("session:secret",this._secret),this.persistLinked(),this}persistLinked(){this._storage.setItem("session:linked",this._linked?"1":"0")}}exports.Session=Session;