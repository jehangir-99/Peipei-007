import _inheritsLoose from"@babel/runtime/helpers/esm/inheritsLoose";import _defineProperty from"@babel/runtime/helpers/esm/defineProperty";import React,{PureComponent}from"react";function withSideEffect(reducePropsToState,handleStateChangeOnClient){if("production"!==process.env.NODE_ENV){if("function"!=typeof reducePropsToState)throw new Error("Expected reducePropsToState to be a function.");if("function"!=typeof handleStateChangeOnClient)throw new Error("Expected handleStateChangeOnClient to be a function.")}return function(WrappedComponent){if("production"!==process.env.NODE_ENV&&"function"!=typeof WrappedComponent)throw new Error("Expected WrappedComponent to be a React component.");var state,mountedInstances=[];function emitChange(){state=reducePropsToState(mountedInstances.map((function(instance){return instance.props}))),handleStateChangeOnClient(state)}var SideEffect=function(_PureComponent){function SideEffect(){return _PureComponent.apply(this,arguments)||this}_inheritsLoose(SideEffect,_PureComponent),SideEffect.peek=function(){return state};var _proto=SideEffect.prototype;return _proto.componentDidMount=function(){mountedInstances.push(this),emitChange()},_proto.componentDidUpdate=function(){emitChange()},_proto.componentWillUnmount=function(){var index=mountedInstances.indexOf(this);mountedInstances.splice(index,1),emitChange()},_proto.render=function(){return React.createElement(WrappedComponent,this.props)},SideEffect}(PureComponent);return _defineProperty(SideEffect,"displayName","SideEffect("+function(WrappedComponent){return WrappedComponent.displayName||WrappedComponent.name||"Component"}(WrappedComponent)+")"),SideEffect}}export default withSideEffect;